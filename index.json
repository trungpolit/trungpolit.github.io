[{"content":"Intro  We\u0026rsquo;ll be using yml/yaml format for all examples down below, I recommend using yml over toml as it is easier to read. You can find any YML to TOML converters if necessary.   Guide Follow Quick Start guide to setup hugo and create a new site.\n Note: Use -f to select yml format\nhugo new site \u0026lt;name of site\u0026gt; -f yml\n Make sure you install latest version of hugo(\u0026gt;=0.82.0).\nAfter you have created a new site, at Step 3 follow the steps:\nMethod 1 Inside the folder of your Hugo site, run:\ngit clone https://github.com/adityatelange/hugo-PaperMod themes/PaperMod --depth=1 Note: You may use  --branch v5.0 to end of above command if you want to stick to specific release.\n Updating theme :\ncd themes/PaperMod git pull  Method 2 you can use as submodule with\ngit submodule add https://github.com/adityatelange/hugo-PaperMod.git themes/PaperMod --depth=1 git submodule update --init --recursive # needed when you reclone your repo (submodules may not get cloned automatically) Note: You may use  --branch v5.0 to end of above command if you want to stick to specific release.\n Updating theme :\ngit submodule update --remote --merge  Method 3 Or you can Download as Zip from Github Page and extract in your themes directory\nDirect Links:\n Master Branch (Latest) v5.0 v4.0 v3.0 v2.0 v1.0  Finally \u0026hellip; Add in config.yml:\ntheme: \u0026#34;PaperMod\u0026#34;  Quick Links   Papermod - Features   Papermod - FAQs   Papermod - Variables   Papermod - Icons   ChangeLog    Sample config.yml  Example Site Structure is present here: exampleSite\n Use appropriately\nbaseURL: \u0026#34;https://examplesite.com/\u0026#34; title: ExampleSite paginate: 5 theme: PaperMod enableRobotsTXT: true buildDrafts: false buildFuture: false buildExpired: false googleAnalytics: UA-123-45 minify: disableXML: true minifyOutput: true params: env: production # to enable google analytics, opengraph, twitter-cards and schema. title: ExampleSite description: \u0026#34;ExampleSite description\u0026#34; keywords: [Blog, Portfolio, PaperMod] author: Me # author: [\u0026#34;Me\u0026#34;, \u0026#34;You\u0026#34;] # multiple authors images: [\u0026#34;\u0026lt;link or path of image for opengraph, twitter-cards\u0026gt;\u0026#34;] DateFormat: \u0026#34;January 2, 2006\u0026#34; defaultTheme: auto # dark, light disableThemeToggle: false ShowReadingTime: true ShowShareButtons: true ShowPostNavLinks: true ShowBreadCrumbs: true ShowCodeCopyButtons: false disableSpecial1stPost: false disableScrollToTop: false comments: false hidemeta: false hideSummary: false showtoc: false tocopen: false assets: # disableHLJS: true # to disable highlight.js # disableFingerprinting: true favicon: \u0026#34;\u0026lt;link / abs url\u0026gt;\u0026#34; favicon16x16: \u0026#34;\u0026lt;link / abs url\u0026gt;\u0026#34; favicon32x32: \u0026#34;\u0026lt;link / abs url\u0026gt;\u0026#34; apple_touch_icon: \u0026#34;\u0026lt;link / abs url\u0026gt;\u0026#34; safari_pinned_tab: \u0026#34;\u0026lt;link / abs url\u0026gt;\u0026#34; label: text: \u0026#34;Home\u0026#34; icon: /apple-touch-icon.png iconHeight: 35 # profile-mode profileMode: enabled: false # needs to be explicitly set title: ExampleSite subtitle: \u0026#34;This is subtitle\u0026#34; imageUrl: \u0026#34;\u0026lt;img location\u0026gt;\u0026#34; imageWidth: 120 imageHeight: 120 imageTitle: my image buttons: - name: Posts url: posts - name: Tags url: tags # home-info mode homeInfoParams: Title: \u0026#34;Hi there \\U0001F44B\u0026#34; Content: Welcome to my blog socialIcons: - name: twitter url: \u0026#34;https://twitter.com/\u0026#34; - name: stackoverflow url: \u0026#34;https://stackoverflow.com\u0026#34; - name: github url: \u0026#34;https://github.com/\u0026#34; analytics: google: SiteVerificationTag: \u0026#34;XYZabc\u0026#34; bing: SiteVerificationTag: \u0026#34;XYZabc\u0026#34; yandex: SiteVerificationTag: \u0026#34;XYZabc\u0026#34; cover: hidden: true # hide everywhere but not in structured data hiddenInList: true # hide on list pages and home hiddenInSingle: true # hide on single page editPost: URL: \u0026#34;https://github.com/\u0026lt;path_to_repo\u0026gt;/content\u0026#34; Text: \u0026#34;Suggest Changes\u0026#34; # edit text appendFilePath: true # to append file path to Edit link # for search # https://fusejs.io/api/options.html fuseOpts: isCaseSensitive: false shouldSort: true location: 0 distance: 1000 threshold: 0.4 minMatchCharLength: 0 keys: [\u0026#34;title\u0026#34;, \u0026#34;permalink\u0026#34;, \u0026#34;summary\u0026#34;, \u0026#34;content\u0026#34;] menu: main: - identifier: categories name: categories url: /categories/ weight: 10 - identifier: tags name: tags url: /tags/ weight: 20 - identifier: example name: example.org url: https://example.org weight: 30 # Read: https://github.com/adityatelange/hugo-PaperMod/wiki/FAQs#using-hugos-syntax-highlighter-chroma # pygmentsUseClasses: true # markup: # highlight: # # anchorLineNos: true # codeFences: true # guessSyntax: true # lineNos: true # style: monokai  Sample Page.md --- title: \u0026#34;My 1st post\u0026#34; date: 2020-09-15T11:30:03+00:00 # weight: 1 # aliases: [\u0026#34;/first\u0026#34;] tags: [\u0026#34;first\u0026#34;] author: \u0026#34;Me\u0026#34; # author: [\u0026#34;Me\u0026#34;, \u0026#34;You\u0026#34;] # multiple authors showToc: true TocOpen: false draft: false hidemeta: false comments: false description: \u0026#34;Desc Text.\u0026#34; canonicalURL: \u0026#34;https://canonical.url/to/page\u0026#34; disableHLJS: true # to disable highlightjs disableShare: false disableHLJS: false hideSummary: false searchHidden: true ShowReadingTime: true ShowBreadCrumbs: true ShowPostNavLinks: true cover: image: \u0026#34;\u0026lt;image path/url\u0026gt;\u0026#34; # image path/url alt: \u0026#34;\u0026lt;alt text\u0026gt;\u0026#34; # alt text caption: \u0026#34;\u0026lt;text\u0026gt;\u0026#34; # display caption under cover relative: false # when using page bundles set this to true hidden: true # only hide on current single page editPost: URL: \u0026#34;https://github.com/\u0026lt;path_to_repo\u0026gt;/content\u0026#34; Text: \u0026#34;Suggest Changes\u0026#34; # edit text appendFilePath: true # to append file path to Edit link --- You can use it by creating archetypes/post.md\nhugo new --kind post \u0026lt;name\u0026gt;  ","permalink":"https://lifesucks.dev/posts/papermod/papermod-installation/","summary":"Read Install and Update instructions here","title":"Installation | Update"},{"content":"Intro   We\u0026rsquo;ll be using yml/yaml format for all examples down below, I recommend using yml over toml as it is easier to read.\n  You can find any YML to TOML converters if necessary.\n   Assets (js/css) The following is enabled by default\n minification - makes the assets size smallest as possible. bundling - bundles all the styles in one single asset fingerprint/integrity check.   Default Theme light/dark/auto params: # defaultTheme: light # defaultTheme: dark defaultTheme: auto # to switch between dark or light according to browser theme   Theme Switch Toggle (enabled by default) Shows icon besides title of page to change theme\nTo disable it :\ndisableThemeToggle: true You can refer following table for better understanding\u0026hellip;\n   defaultTheme disableThemeToggle checks local storage? checks system theme? Info     auto true No Yes only system theme    false Yes (if not-\u0026gt;2) Yes (2) switch present   dark true No No force dark only    false Yes No switch present   light true No No force light only    false Yes No switch present     Archives Layout Create a page with archive.md in content directory with following content\n. ‚îú‚îÄ‚îÄ config.yml ‚îú‚îÄ‚îÄ content/ ‚îÇ ‚îú‚îÄ‚îÄ archives.md \u0026lt;--- Create archive.md here ‚îÇ ‚îî‚îÄ‚îÄ posts/ ‚îú‚îÄ‚îÄ static/ ‚îî‚îÄ‚îÄ themes/ ‚îî‚îÄ‚îÄ PaperMod/ and add the following to it\n--- title: \u0026#34;Archive\u0026#34; layout: \u0026#34;archives\u0026#34; url: \u0026#34;/archives/\u0026#34; summary: archives --- Note: Archives Layout does not support Multilingual Month Translations.\nex: archives.md\n Regular Mode (default-mode)  Home-Info Mode Use 1st entry as some Information\nadd following to config file\nparams: homeInfoParams: Title: Hi there wave Content: Can be Info, links, about... socialIcons: # optional - name: \u0026#34;\u0026lt;platform\u0026gt;\u0026#34; url: \u0026#34;\u0026lt;link\u0026gt;\u0026#34; - name: \u0026#34;\u0026lt;platform 2\u0026gt;\u0026#34; url: \u0026#34;\u0026lt;link2\u0026gt;\u0026#34; ex. config.yml#L106\n Profile Mode Shows Index/Home page as Full Page with Social Links and Image\nadd following to config file\nparams: profileMode: enabled: true title: \u0026#34;\u0026lt;Title\u0026gt;\u0026#34; # optional default will be site title subtitle: \u0026#34;This is subtitle\u0026#34; imageUrl: \u0026#34;\u0026lt;image link\u0026gt;\u0026#34; # optional imageTitle: \u0026#34;\u0026lt;title of image as alt\u0026gt;\u0026#34; # optional imageWidth: 120 # custom size imageHeight: 120 # custom size buttons: - name: Archive url: \u0026#34;/archive\u0026#34; - name: Github url: \u0026#34;https://github.com/\u0026#34; socialIcons: # optional - name: \u0026#34;\u0026lt;platform\u0026gt;\u0026#34; url: \u0026#34;\u0026lt;link\u0026gt;\u0026#34; - name: \u0026#34;\u0026lt;platform 2\u0026gt;\u0026#34; url: \u0026#34;\u0026lt;link2\u0026gt;\u0026#34;  Search Page PaperMod uses Fuse.js Basic for seach functionality\nAdd the following to site config, config.yml\noutputs: home: - HTML - RSS - JSON # is necessary Create a page with search.md in content directory with following content\n--- title: \u0026#34;Search\u0026#34; # in any language you want layout: \u0026#34;search\u0026#34; # is necessary # url: \u0026#34;/archive\u0026#34; # description: \u0026#34;Description for Search\u0026#34; summary: \u0026#34;search\u0026#34; --- To hide a particular page from being searched, add it in post\u0026rsquo;s fron\u0026rsquo;t matter\n--- searchHidden: true ex: search.md\n Search Page also has Key bindings:\n Arrow keys to move up/down the list Enter key (return) or Right Arrow key to Go to highlighted page Escape key to clear searchbox and results   For Multilingual use search.\u0026lt;lang\u0026gt;.md ex. search.es.md.\nNote: Search will work only on current language, user is currently on !\nCustomizing Fusejs Options\nRefer https://fusejs.io/api/options.html for Options, Add those as shown below.\nparams: fuseOpts: isCaseSensitive: false shouldSort: true location: 0 distance: 1000 threshold: 0.4 minMatchCharLength: 0 keys: [\u0026#34;title\u0026#34;, \u0026#34;permalink\u0026#34;, \u0026#34;summary\u0026#34;, \u0026#34;content\u0026#34;]  Draft Page indication adds [draft] mark to indicate draft pages.\n Post Cover Image In post\u0026rsquo;s page-variables add :\ncover: image: \u0026#34;\u0026lt;image path/url\u0026gt;\u0026#34; # can also paste direct link from external site # ex. https://i.ibb.co/K0HVPBd/paper-mod-profilemode.png alt: \u0026#34;\u0026lt;alt text\u0026gt;\u0026#34; caption: \u0026#34;\u0026lt;text\u0026gt;\u0026#34; relative: false # To use relative path for cover image, used in hugo Page-bundles When you include images in the Page Bundle, multiple sizes of the image will automatically be provided using the HTML5 srcset field.\nTo reduce generation time and size of the site, you can disable this feature using\nparams: cover: responsiveImages: false To enable hyperlinks to the full image size on post pages, use\nparams: cover: linkFullImages: true  Share Buttons on post Displays Share Buttons at Bottom of each post\nto show share buttons add\nparams: ShowShareButtons: true  Show post reading time Displays Reading Time (the estimated time, in minutes, it takes to read the content.)\nTo show reading time add\nParams: ShowReadingTime: true  Show Table of Contents (Toc) on blog post Displays ToC on blog-pages\nTo show ToC add following to page-variables\nShowToc: true To keep Toc Open by default on a post add following to page-variables:\nTocOpen: true  BreadCrumb Navigation Adds BreadCrumb Navigation above Post\u0026rsquo;s Title to show subsections and Navigation to Home\nparams: ShowBreadCrumbs: true Can be diabled for particular page\u0026rsquo;s front-matter\n--- ShowBreadCrumbs: false ---  Edit Link for Posts Add a button to suggest changes by using the file path of the post to link to a edit destination.\nFor site config use:\nParams: editPost: URL: \u0026#34;https://github.com/\u0026lt;path_to_repo\u0026gt;/content\u0026#34; Text: \u0026#34;Suggest Changes\u0026#34; # edit text appendFilePath: true # to append file path to Edit link Can be modified for individual pages\n--- editPost: URL: \u0026#34;https://github.com/\u0026lt;path_to_repo\u0026gt;/content\u0026#34; Text: \u0026#34;Suggest Changes\u0026#34; # edit text appendFilePath: true # to append file path to Edit link --- The example above would yield the following link for the post file posts/post-name.md: https://github.com/\u0026lt;path_to_repo\u0026gt;/content/posts/post-name.md\n   Parameter Required Default Value     editPost.URL true -   editPost.appendFilePath false false   editPost.Text false \u0026ldquo;Edit\u0026rdquo;    Since the link generated is a regular HTML anchor tag \u0026lt;a href=...\u0026gt;, you can also use other URL schemas like mailto://, e.g. URL: \u0026quot;mailto://mail@example.com?subject=Suggesting changes for \u0026quot;\n Other Posts suggestion below a post Adds a Previous / Next post suggestion under a single post\nparams: ShowPostNavLinks: true  Multiple Authors To Use multiple authors for a post, in post-variables:\n--- author: [\u0026#34;Me\u0026#34;, \u0026#34;You\u0026#34;] --- To use Multiple Authors Site-wide, in config.yml:\nparams: author: [\u0026#34;Me\u0026#34;, \u0026#34;You\u0026#34;]  Comments to add comments, create a html file\nlayouts/partials/comments.html\nand paste code provided by your comments provider\nalso in config add this\nparams: comments: true read more about this hugo-comments\n AccessKeys c - ToC Open/Close g - Go To Top h - Home (according to current lang) t - Theme toggle / - Jumps to search page if in menu What\u0026rsquo;s AccessKeys ?\n Enhanced SEO Enabled only when env: production\n Rich Results/Snippets Support  Twitter Cards Support  The Twitter Cards metadata, except twitter:image should not require additional configuration, since it is generated from metadata that you should already have (for instance the page title and description). The twitter:image uses the Post Cover Image, if present. In the absence of a cover images, the first image from the images frontmatter (a list) is used. images: - image_01.png - image_02.png  Finally, if neither of those are provided, twitter:image comes from the first Page Bundle image with feature in the name, with a fallback to the first image with cover or thumbnail in the name.  OpenGraph support  The OpenGraph metadata, except og:image should not require additional configuration, since it is generated from metadata that you should already have (for instance the page title and description). The og:image uses the Post Cover Image, if present. In the absence of a cover images, the first image from the images frontmatter (a list) is used. images: - image_01.png - image_02.png  Finally, if neither of those are provided, og:image comes from the first Page Bundle image with feature in the name, with a fallback to the first image with cover or thumbnail in the name. For pages, you can also add audio (using frontmatter audio: filename.ext) and/or videos. videos: - filename01.mov - filename02.avi    Multilingual Support  Misc Scroll-Bar themed (by default) Smooth Scroll between in-page links (by default) Scroll-to-Top Button (by default) Displays a Scroll-to-Top button in right-bottom corner Google Analytics integration Syntax highlighting RSS feeds ","permalink":"https://lifesucks.dev/posts/papermod/papermod-features/","summary":"Learn About All Features in PaperMod","title":"Features"},{"content":"This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\nHeadings The following HTML \u0026lt;h1\u0026gt;‚Äî\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nH1 H2 H3 H4 H5 H6 Paragraph Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nBlockquotes The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\nBlockquote without attribution  Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\n Blockquote with attribution  Don\u0026rsquo;t communicate by sharing memory, share memory by communicating.\n‚Äî Rob Pike1\n Tables Tables aren\u0026rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\n   Name Age     Bob 27   Alice 23    Inline Markdown within tables    Italics Bold Code     italics bold code    Code Blocks Code block with backticks \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Code block indented with four spaces \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;  Code block with Hugo\u0026rsquo;s internal highlight shortcode \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; List Types Ordered List  First item Second item Third item  Unordered List  List item Another item And another item  Nested list  Fruit  Apple Orange Banana   Dairy  Milk Cheese    Other Elements ‚Äî abbr, sub, sup, kbd, mark GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL+ALT+Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\n  The above quote is excerpted from Rob Pike\u0026rsquo;s talk during Gopherfest, November 18, 2015.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n  ","permalink":"https://lifesucks.dev/posts/markdown-syntax.fr/","summary":"\u003cp\u003eThis article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\u003c/p\u003e","title":"Markdown Syntax Guide For L2"},{"content":"This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\nHeadings The following HTML \u0026lt;h1\u0026gt;‚Äî\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nH1 H2 H3 H4 H5 H6 Paragraph Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nBlockquotes The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\nBlockquote without attribution  Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\n Blockquote with attribution  Don\u0026rsquo;t communicate by sharing memory, share memory by communicating.\n‚Äî Rob Pike1\n Tables Tables aren\u0026rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\n   Name Age     Bob 27   Alice 23    Inline Markdown within tables    Italics Bold Code     italics bold code    Code Blocks Code block with backticks \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Code block indented with four spaces \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;  Code block with Hugo\u0026rsquo;s internal highlight shortcode \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; List Types Ordered List  First item Second item Third item  Unordered List  List item Another item And another item  Nested list  Fruit  Apple Orange Banana   Dairy  Milk Cheese    Other Elements ‚Äî abbr, sub, sup, kbd, mark GIF is a bitmap image format.\nH2O\nXn + Yn: Zn\nPress CTRL+ALT+Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\n  The above quote is excerpted from Rob Pike\u0026rsquo;s talk during Gopherfest, November 18, 2015.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n  ","permalink":"https://lifesucks.dev/posts/markdown-syntax.fa/","summary":"\u003cp\u003eThis article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\u003c/p\u003e","title":"Markdown Syntax Guide For RTL"},{"content":"This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\nHeadings The following HTML \u0026lt;h1\u0026gt;‚Äî\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nH1 H2 H3 H4 H5 H6 Paragraph Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nBlockquotes The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\nBlockquote without attribution  Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\n Blockquote with attribution  Don\u0026rsquo;t communicate by sharing memory, share memory by communicating.\n‚Äî Rob Pike1\n Tables Tables aren\u0026rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\n   Name Age     Bob 27   Alice 23    Inline Markdown within tables    Italics Bold Code     italics bold code    Code Blocks Code block with backticks \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Code block indented with four spaces \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;  Code block with Hugo\u0026rsquo;s internal highlight shortcode \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Gist  List Types Ordered List  First item Second item Third item  Unordered List  List item Another item And another item  Nested list  Fruit  Apple Orange Banana   Dairy  Milk Cheese    Other Elements ‚Äî abbr, sub, sup, kbd, mark GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL+ALT+Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\n  The above quote is excerpted from Rob Pike\u0026rsquo;s talk during Gopherfest, November 18, 2015.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n  ","permalink":"https://lifesucks.dev/posts/markdown-syntax/","summary":"\u003cp\u003eThis article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\u003c/p\u003e","title":"Markdown Syntax Guide"},{"content":"Hugo ships with several Built-in Shortcodes for rich content, along with a Privacy Config and a set of Simple Shortcodes that enable static and no-JS versions of various social media embeds.\n YouTube Privacy Enhanced Shortcode    Twitter Simple Shortcode ‚ÄúIn addition to being more logical, asymmetry has the advantage that its complete appearance is far more optically effective than symmetry.‚Äù\n‚Äî Jan Tschichold pic.twitter.com/gcv7SrhvJb\n\u0026mdash; Graphic Design History (@DesignReviewed) January 17, 2019  Vimeo Simple Shortcode  .__h_video { position: relative; padding-bottom: 56.23%; height: 0; overflow: hidden; width: 100%; background: #000; } .__h_video img { width: 100%; height: auto; color: #000; } .__h_video .play { height: 72px; width: 72px; left: 50%; top: 50%; margin-left: -36px; margin-top: -36px; position: absolute; cursor: pointer; }  ","permalink":"https://lifesucks.dev/posts/rich-content/","summary":"\u003cp\u003eHugo ships with several \u003ca href=\"https://gohugo.io/content-management/shortcodes/#use-hugos-built-in-shortcodes\"\u003eBuilt-in Shortcodes\u003c/a\u003e for rich content, along with a \u003ca href=\"https://gohugo.io/about/hugo-and-gdpr/\"\u003ePrivacy Config\u003c/a\u003e and a set of Simple Shortcodes that enable static and no-JS versions of various social media embeds.\u003c/p\u003e","title":"Rich Content"},{"content":"Mathematical notation in a Hugo project can be enabled by using third party JavaScript libraries.\nIn this example we will be using KaTeX\n Create a partial under /layouts/partials/math.html Within this partial reference the Auto-render Extension or host these scripts locally. Include the partial in your templates (extend_head.html) like so: refer ISSUE #236  {{ if or .Params.math .Site.Params.math }} {{ partial \u0026#34;math.html\u0026#34; . }} {{ end }}  To enable KaTex globally set the parameter math to true in a project\u0026rsquo;s configuration To enable KaTex on a per page basis include the parameter math: true in content files  Note: Use the online reference of Supported TeX Functions\n  Examples  Inline math: \\(\\varphi = \\dfrac{1+\\sqrt5}{2}= 1.6180339887‚Ä¶\\) Block math:\n$$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$\n","permalink":"https://lifesucks.dev/posts/math-typesetting/","summary":"\u003cp\u003eMathematical notation in a Hugo project can be enabled by using third party JavaScript libraries.\u003c/p\u003e","title":"Math Typesetting"},{"content":"Emoji can be enabled in a Hugo project in a number of ways.\nThe emojify function can be called directly in templates or Inline Shortcodes.\nTo enable emoji globally, set enableEmoji to true in your site\u0026rsquo;s configuration and then you can type emoji shorthand codes directly in content files; e.g.\nüôà üôà üôâ üôâ üôä üôä\nThe Emoji cheat sheet is a useful reference for emoji shorthand codes.\n N.B. The above steps enable Unicode Standard emoji characters and sequences in Hugo, however the rendering of these glyphs depends on the browser and the platform. To style the emoji you can either use a third party emoji font or a font stack; e.g.\n.emoji { font-family: Apple Color Emoji, Segoe UI Emoji, NotoColorEmoji, Segoe UI Symbol, Android Emoji, EmojiSymbols; }  .emojify { font-family: Apple Color Emoji, Segoe UI Emoji, NotoColorEmoji, Segoe UI Symbol, Android Emoji, EmojiSymbols; font-size: 2rem; vertical-align: middle; } @media screen and (max-width:650px) { .nowrap { display: block; margin: 25px 0; } } ","permalink":"https://lifesucks.dev/posts/emoji-support/","summary":"\u003cp\u003eEmoji can be enabled in a Hugo project in a number of ways.\u003c/p\u003e","title":"Emoji Support"},{"content":"1. Facebook newsfeed l√† g√¨? 1 Newsfeed l√† 1 danh s√°ch c√°c b√†i stories ƒë∆∞·ª£c c·∫≠p nh·∫≠t li√™n t·ª•c n·∫±m ch√≠nh gi·ªØa trang Facebook‚Äôs homepage. N√≥ bao g·ªìm c√°c c·∫≠p nh·∫≠t li√™n quan t·ªõi tr·∫°ng th√°i status, photos, videos, links, app activity hay c√°c likes t·ª´ nh·ªØng ng∆∞·ªùi, trang pages, hay groups m√† ng∆∞·ªùi d√πng user theo d√µi follow tr√™n Facebook.\nV·ªõi b·∫•t c·ª© h·ªá th·ªëng m·∫°ng x√£ h·ªôi n√†o m√† b·∫°n thi·∫øt k·∫ø nh∆∞ Twitter, Instagram, hay Facebook th√¨ b·∫°n s·∫Ω c·∫ßn 1 h·ªá th·ªëng ki·ªÉu Newsfeed ƒë·ªÉ hi·ªán th·ªã c√°c th√¥ng tin c·∫≠p nh·∫≠t t·ª´ nh·ªØng ng∆∞·ªùi b·∫°n v√† nh·ªØng ng∆∞·ªùi m√† b·∫°n theo d√µi.\n2. Y√™u c·∫ßu Requirements v√† m·ª•c ti√™u Goals c·ªßa h·ªá th·ªëng Ch√∫ng ta s·∫Ω thi·∫øt k·∫ø 1 h·ªá th·ªëng newsfeed cho Facebook theo c√°c y√™u c·∫ßu sau: Y√™u c·∫ßu v·ªÅ m·∫∑t t√≠nh nƒÉng:\n Newsfeed c·∫ßn ƒë∆∞·ª£c t·∫°o ra d·ª±a tr√™n c√°c b√†i posts t·ª´ nh·ªØng ng∆∞·ªùi, trang pages, groups m√† ng∆∞·ªùi d√πng user theo d√µi follow. 1 ng∆∞·ªùi d√πng user c√≥ th·ªÉ c√≥ r·∫•t nhi·ªÅu b·∫°n v√† theo d√µi follow 1 l∆∞·ª£ng l·ªõn c√°c pages/groups. Feeds c√≥ th·ªÉ ch·ª© images, videos, hay ch·ªâ ch·ª©a text. H·ªá th·ªëng c·ªßa ch√∫ng ta c·∫ßn h·ªó tr·ª£ th√™m m·ªõi c√°c b√†i posts m·ªõi nhanh nh·∫•t c√≥ th·ªÉ khi ch√∫ng v·ª´a m·ªõi xu·∫•t hi·ªán cho t·∫•t c·∫£ c√°c users ƒëang ho·∫°t ƒë·ªông.  Y√™u c·∫ßu kh√¥ng li√™n quan t·ªõi t√≠nh nƒÉng:\n H·ªá th·ªëng c√≥ kh·∫£ nƒÉng t·∫°o ra newsfeed cho b·∫•t c·ª© user n√†o 1 c√°ch real-time v√† ƒë·ªô tr·ªÖ t·ªëi ƒëa l√† 2s. 1 b√†i post kh√¥ng c·∫ßn t·ªõi 5s ƒë·ªÉ n√≥ xu·∫•t hi·ªán trong feed c·ªßa 1 user gi·∫£ ƒë·ªãnh l√† b√†i post v·ª´a ƒë∆∞·ª£c ƒëƒÉng.  3. ∆Ø·ªõc l∆∞·ª£ng tr·ªØ l∆∞·ª£ng v√† c√°c r√†ng bu·ªôc Ta gi·∫£ ƒë·ªãnh 1 user trung b√¨nh s·∫Ω c√≥ 300 b·∫°n v√† theo d√µi 200 pages.\n∆Ø·ªõc l∆∞·ª£ng v·ªÅ traffic: Gi·∫£ s·ª≠ ta c√≥ 300M ng∆∞·ªùi d√πng ho·∫°t ƒë·ªông h√†ng ng√†y v√† trung b√¨nh m·ªói ng∆∞·ªùi d√πng s·∫Ω l√†m m·ªõi timeline c·ªßa h·ªç 5 l·∫ßn 1 ng√†y. K·∫øt qu·∫£ l√† s·∫Ω c√≥ 1.5B newsfeed request 1 ng√†y v√† x·∫•p x·ªâ 17,500 request m·ªói gi√¢y.\n∆Ø·ªõc l∆∞·ª£ng v·ªÅ storage: ·ªû m·ª©c trung b√¨nh, ta gi·∫£ ƒë·ªãnh ch√∫ng ta c√≥ kho·∫£ng 500 posts tr√™n m·ªçi newsfeed c·ªßa m·ªói user v√† ch√∫ng ta s·∫Ω gi·ªØ ch√∫ng trong b·ªô nh·ªõ memory ƒë·ªÉ l·∫•y ch√∫ng ra 1 c√°ch nhanh nh·∫•t. Ch√∫ng ta c≈©ng gi·∫£ ƒë·ªãnh r·∫±ng trung b√¨nh m·ªói b√†i post c√≥ k√≠ch th∆∞·ªõc kho·∫£ng 1KB. ƒêi·ªÅu n√†y c√≥ nghƒ©a r·∫±ng ch√∫ng ta c·∫ßn l∆∞u tr·ªØ kho·∫£ng 500KB d·ªØ li·ªáu data tr√™n m·ªói user. ƒê·ªÉ l∆∞u tr·ªØ ƒë∆∞·ª£c t·∫•t c·∫£ data cho t·∫•t c·∫£ c√°c users ƒëang active ch√∫ng ta c·∫ßn 150TB memory. N·∫øu 1 server c√≥ th·ªÉ ƒë√°p ·ª©ng ƒë∆∞·ª£c 100GB th√¨ ch√∫ng ta c·∫ßn kho·∫£ng 1500 servers ƒë·ªÉ gi·ªØ ƒë∆∞·ª£c 500 b√†i posts m·ªõi nh·∫•t trong memory cho t·∫•t c·∫£ c√°c users ƒëang active.\n4. System APIs  Khi ta ƒë√£ ch·ªët ƒë∆∞·ª£c c√°c y√™u c·∫ßu requirements, th√¨ √Ω t∆∞·ªüng t·ªët l√† ƒë·ªãnh nghƒ©a c√°c system APIs. ƒêi·ªÅu n√†y s·∫Ω ph·∫£n √°nh ƒë√∫ng nh·ªØng g√¨ m√† h·ªá th·ªëng k√¨ v·ªçng.\n Ch√∫ng ta c·∫ßn c√≥ SOAP hay REST APIs ƒë·ªÉ expose ra c√°c t√≠nh nƒÉng c·ªßa c√°c service. ƒêo·∫°n v√≠ d·ª• d∆∞·ªõi d√πng ƒë·ªÉ ƒë·ªãnh nghƒ©a API d√πng ƒë·ªÉ l·∫•y ra newsfeed:\ngetUserFeed(api_dev_key, user_id, since_id, count, max_id, exclude_replies) C√°c tham s·ªë:\n api_dev_key (string): Api developer key c·∫ßn ph·∫£i ƒë∆∞·ª£c ƒëƒÉng k√Ω ƒë·ªÉ s·ª≠ d·ª•ng v√† d√πng ƒë·ªÉ throttle users d·ª±a tr√™n h·∫°n m·ª©c quota m√† h·ªç ƒë∆∞·ª£c c·∫•p. user_id (number): ID c·ªßa user m√† h·ªá th·ªëng d√πng ƒë·ªÉ t·∫°o newsfeed. since_id (number): Kh√¥ng b·∫Øt bu·ªôc, tr·∫£ v·ªÅ k·∫øt qu·∫£ v·ªõi 1 ID cao h∆°n (m·ªõi h∆°n) ID cho tr∆∞·ªõc. count (number): Kh√¥ng b·∫Øt bu·ªôc, ƒë·ªãnh nghƒ©a s·ªë l∆∞·ª£ng c√°c feed items c·∫ßn l·∫•y ra, gi·ªõi h·∫°n max l√† 200. max_id (number): Kh√¥ng b·∫Øt bu·ªôc, tr·∫£ v·ªÅ k·∫øt qu·∫£ v·ªõi 1 ID nh·ªè h∆°n ho·∫∑c b·∫±ng (c≈© h∆°n) ID cho tr∆∞·ªõc. exclude_replies(boolean): Kh√¥ng b·∫Øt bu·ªôc, Tham s·ªë n√†y s·∫Ω ngƒÉn ch·∫∑n vi·ªác tr·∫£ v·ªÅ c√°c replies xu·∫•t hi·ªán trong k·∫øt qu·∫£ timeline ƒë∆∞·ª£c tr·∫£ v·ªÅ.  K·∫øt qu·∫£ tr·∫£ v·ªÅ: (JSON) tr·∫£ v·ªÅ 1 JSON object ch·ª©a 1 danh s√°ch c√°c feed items.\n5. Database Design Ta s·∫Ω c√≥ 3 ƒë·ªëi t∆∞·ª£ng objects ch√≠nh: User, Entity (e.g. page, group, etc.), and FeedItem (or Post). D∆∞·ªõi ƒë√¢y l√† 1 v√†i quan s√°t v·ªÅ quan h·ªá relationships gi·ªØa c√°c ƒë·ªëi t∆∞·ª£ng n√†y:\n 1 user c√≥ th·ªÉ follow c√°c ƒë·ªëi t∆∞·ª£ng entities kh√°c v√† c√≥ th·ªÉ l√† b·∫°n v·ªõi users kh√°c. C·∫£ users v√† c√°c ƒë·ªëi t∆∞·ª£ng entities c√≥ th·ªÉ post FeedItems ch·ª©a text, images hay videos. M·ªói FeedItem s·∫Ω c√≥ 1 UserID d√πng ƒë·ªÉ x√°c ƒë·ªãnh User t·∫°o ra n√≥. Cho ƒë∆°n gi·∫£n, ta gi·∫£ ƒë·ªãnh ch·ªâ c√≥ users m·ªõi t·∫°o ƒë∆∞·ª£c feed items m·∫∑c d√π Facebook Pages c≈©ng c√≥ th·ªÉ t·∫°o ra. M·ªói FeedItem c√≥ th·ªÉ c√≥ 1 EntityID d√πng ƒë·ªÉ tr·ªè t·ªõi trang page hay group m√† b√†i posts ƒë∆∞·ª£c t·∫°o ra.  N·∫øu ta ƒëang s·ª≠ d·ª•ng 1 relational database, ch√∫ng ta s·∫Ω c·∫ßn m√¥ h√¨nh h√≥a 2 m·ªëi quan h·ªá relations: User-Entity relation v√† FeedItem-Media relation. Do m·ªói user c√≥ th·ªÉ l√† b·∫°n v·ªõi nhi·ªÅu ng∆∞·ªùi kh√°c v√† theo d√µi follow r·∫•t nhi·ªÅu ƒë·ªëi t∆∞·ª£ng entities, ta c√≥ th·ªÉ l∆∞u tr·ªØ m·ªëi quan h·ªá relation ra th√†nh b·∫£ng table ri√™ng. c·ªôt \u0026ldquo;Type\u0026rdquo; trong b·∫£ng \u0026ldquo;UserFollow\u0026rdquo; d√πng ƒë·ªÉ x√°c ƒë·ªãnh ƒë·ªëi t∆∞·ª£ng entity ƒëang ƒë∆∞·ª£c follow l√† 1 User hay Entity. T∆∞∆°ng t·ª± ta c≈©ng c·∫ßn c√≥ 1 b·∫£ng table cho FeedMedia relation.\n6. High Level System Design ·ªû m·ª©c high level, v·∫•n ƒë·ªÅ c·ªßa ch√∫ng ta chia l√†m 2 ph·∫ßn:\nFeed generation: Newsfeed ƒë∆∞·ª£c t·∫°o t·ª´ c√°c b√†i posts (hay feed items) t·ª´ nh·ªØng users hay entities (pages hay groups) m√† 1 user theo d√µi. Do ƒë√≥, b·∫•t c·ª© khi n√†o h·ªá th·ªëng nh·∫≠n ƒë∆∞·ª£c y√™u c·∫ßu t·∫°o feed cho 1 user (v√≠ d·ª• l√† Jane), th√¨ ch√∫ng ta s·∫Ω th·ª±c hi·ªán c√°c b∆∞·ªõc sau:\n L·∫•y v·ªÅ IDs c·ªßa t·∫•t c·∫£ c√°c users v√† entities m√† Jane theo d√µi. L·∫•y v·ªÅ c√°c b√†i posts m·ªõi nh·∫•t, ph·ªï bi·∫øn nh·∫•t, ph√π h·ª£p nh·∫•t cho nh·ªØng IDs n√†y. ƒê√¢y l√† posts ti·ªÅm nƒÉng m√† ta c√≥ th·ªÉ hi·ªán th·ªã ch√∫ng trong newsfeed c·ªßa Jane. ƒê√°nh gi√° c√°c b√†i posts n√†y d·ª±a tr√™n s·ª± ph√π h·ª£p v·ªõi Jane. ƒêi·ªÅu n√†y ph·∫£n √°nh tr·ª±c ti·∫øp v·ªõi feed c·ªßa Jane hi·ªán t·∫°i. L∆∞u tr·ªØ feed n√†y v√†o trong cache v√† tr·∫£ v·ªÅ top c√°c b√†i posts (t·∫ßm 20) ƒë·ªÉ hi·ªán th·ªã trong Jane feed. ·ªû ph√≠a front-end, khi Jane ch·∫°m t·ªõi cu·ªëi feed hi·ªán t·∫°i c·ªßa c√¥ ·∫•y, th√¨ c√¥ ·∫•y c√≥ th·ªÉ l·∫•y v·ªÅ ti·∫øp 20 posts ti·∫øp theo t·ª´ server v√† c·ª© ti·∫øp t·ª•c nh∆∞ v·∫≠y.  Feed publishing: B·∫•t c·ª© khi n√†o Jane load trang newsfeed page c·ªßa c√¥ ·∫•y, c√¥ ·∫•y ph·∫£i th·ª±c hi·ªán request v√† pull c√°c feed items t·ª´ server. B·∫•t c·ª© khi n√†o c√¥ ·∫•y ch·∫°m v√†o ƒë√°y c·ªßa feed hi·ªán t·∫°i, th√¨ c√¥ ·∫•y c√≥ th·ªÉ pull data m·ªõi t·ª´ server. V·ªõi nh·ªØng ph·∫ßn t·ª≠ items m·ªõi h∆°n th√¨ server c√≥ th·ªÉ th√¥ng b√°o cho Jane v√† c√¥ ·∫•y c√≥ th·ªÉ pull hay server c√≥ th·ªÉ push nh·ªØng posts m·ªõi n√†y xu·ªëng. Ch√∫ng ta s·∫Ω b√†n v·ªÅ c√°c l·ª±a ch·ªçn n√†y sau.\n·ªû m·ª©c high level, ch√∫ng ta ch·ªâ c·∫ßn c√°c components sau trong Newsfeed service:\n Web servers: C·∫ßn duy tr√¨ 1 connection v·ªõi user. Connection n√†y c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ chuy·ªÉn d·ªØ li·ªáu data gi·ªØa user v√† server. Application server: Th·ª±c hi·ªán x·ª≠ l√Ω c√°c lu·ªìng nghi·ªáp v·ª• workflows d√πng ƒë·ªÉ l∆∞u tr·ªØ c√°c posts m·ªõi trong database servers. Ch√∫ng ta s·∫Ω c·∫ßn 1 v√†i application servers ƒë·ªÉ l·∫•y v·ªÅ v√† ƒë·ªÉ push newsfeed xu·ªëng end user. Metadata database and cache: D√πng ƒë·ªÉ l∆∞u tr·ªØ c√°c th√¥ng tin metadata li√™n quan t·ªõi Users, Pages, Groups. Posts database and cache: D√πng ƒë·ªÉ l∆∞u tr·ªØ c√°c th√¥ng tin metadata li√™n quan t·ªõi posts v√† c√°c n·ªôi dung contents c·ªßa h·ªç. Video and photo storage, and cache: D·∫°ng blob storage, d√πng ƒë·ªÉ l∆∞u tr·ªØ t·∫•t c·∫£ c√°c media c√≥ trong b√†i posts. Newsfeed generation service: D√πng ƒë·ªÉ thu th·∫≠p v√† x·∫øp h·∫°ng t·∫•t c·∫£ c√°c posts ph√π h·ª£p v·ªõi 1 user ƒë·ªÉ t·∫°o ra newsfeed v√† l∆∞u n√≥ trong cache. Service n√†y c≈©ng s·∫Ω nh·∫≠n c√°c c·∫≠p nh·∫≠t m·ªõi nh·∫•t v√† s·∫Ω th√™m c√°c feed items m·ªõi n√†y v√†o timeline c·ªßa user b·∫•t k·ª≥. Feed notification service: Th√¥ng b√°o cho user c√°c feed items m·ªõi ƒëang c√≥ s·∫µn cho newsfeed c·ªßa h·ªç.  D∆∞·ªõi ƒë√¢y l√† bi·ªÉu ƒë·ªì ki·∫øn tr√∫c ·ªü m·ª©c high-level, User B v√† User C ƒëang theo d√µi User A.\n7. Detailed Component Design Ta s·∫Ω b√†n chi ti·∫øt v·ªÅ 2 components kh√°c nhau.\na. Feed generation Gi·ªù ta x√©t 1 v√≠ d·ª• ƒë∆°n gi·∫£n l√† newsfeed generation service s·∫Ω l·∫•y v·ªÅ c√°c posts m·ªõi nh·∫•t t·ª´ t·∫•t c·∫£ c√°c users v√† entities m√† Jane theo d√µi; c√¢u truy v·∫•n s·∫Ω gi·ªëng nh∆∞ sau:\n(SELECT FeedItemID FROM FeedItem WHERE UserID in ( SELECT EntityOrFriendID FROM UserFollow WHERE UserID = \u0026lt;current_user_id\u0026gt; and type = 0(user)) ) UNION (SELECT FeedItemID FROM FeedItem WHERE EntityID in ( SELECT EntityOrFriendID FROM UserFollow WHERE UserID = \u0026lt;current_user_id\u0026gt; and type = 1(entity)) ) ORDER BY CreationDate DESC LIMIT 100 C√°c issues x·∫£y ra v·ªõi c√°ch thi·∫øt k·∫ø n√†y d√†nh cho newsfeed generation service:\n S·∫Ω r·∫•t ch·∫≠m ƒë·ªëi v·ªõi c√°c users c√≥ nhi·ªÅu b·∫°n friends hay ng∆∞·ªùi theo d√µi follows do ta ph·∫£i th·ª±c hi·ªán sorting/merging/ranking tr√™n 1 l∆∞·ª£ng l·ªõn c√°c posts. Ch√∫ng ta t·∫°o ra timeline khi 1 user th·ª±c hi·ªán load trang page c·ªßa h·ªç. ƒêi·ªÅu n√†y s·∫Ω r·∫•t ch·∫≠m v√† c√≥ ƒë·ªô tr·ªÖ cao. V·ªõi nh·ªØng live updates, m·ªói status update s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t v√†o trong c√°c feed updates c·ªßa t·∫•t c·∫£ c√°c followers. ƒêi·ªÅu n√†y g√¢y ra s·ª± t·ªìn ƒë·ªçng high backlogs trong Newsfeed Generation Service. V·ªõi nh·ªØng live updates, server push (hay th√¥ng b√°o) c√°c posts m·ªõi t·ªõi nh·ªØng users c√≥ th·ªÉ g√¢y ra v·∫•n ƒë·ªÅ n·∫∑ng t·∫£i, ƒë·∫∑c bi·ªát l√† ƒë·ªëi v·ªõi nh·ªØng ng∆∞·ªùi, hay pages c√≥ l∆∞·ª£ng l·ªõn followers. ƒê·ªÉ c·∫£i thi·ªán hi·ªáu nƒÉng, ta c√≥ th·ªÉ t·∫°o tr∆∞·ªõc timeline v√† l∆∞u n√≥ trong 1 memory.  Offline generation for newsfeed: Ch√∫ng ta c·∫ßn c√≥ c√°c servers d√†nh ri√™ng cho vi·ªác li√™n t·ª•c t·∫°o ra c√°c newsfeed c·ªßa users v√† l∆∞u tr·ªØ ch√∫ng trong memory. Do ƒë√≥ b·∫•t c·ª© khi n√†o 1 user request l·∫•y v·ªÅ c√°c posts m·ªõi cho feed c·ªßa h·ªç, ch√∫ng ta c√≥ th·ªÉ ƒë∆°n gi·∫£n l·∫•y c√°c feed n√†y t·ª´ n∆°i l∆∞u tr·ªØ ƒë√£ t·∫°o tr∆∞·ªõc. B·∫±ng c√°ch s·ª≠ d·ª•ng c∆° ch·∫ø n√†y, th√¨ newsfeed c·ªßa user kh√¥ng c·∫ßn ph·∫£i t·∫°o khi c√≥ y√™u c·∫ßu, v√† do ƒë√≥ c√≥ th·ªÉ tr·∫£ v·ªÅ cho users b·∫•t c·ª© khi n√†o c√≥ y√™u c·∫ßu.\nB·∫•t c·ª© khi c√°c servers n√†y c·∫ßn t·∫°o feed cho 1 user, ch√∫ng s·∫Ω truy v·∫•n ƒë·ªÉ l·∫•y v·ªÅ th·ªùi ƒëi·ªÉm t·∫°o feed g·∫ßn nh·∫•t ƒë∆∞·ª£c t·∫°o v·ªõi user n√†y ƒë·∫ßu ti√™n. Sau ƒë√≥, c√°c feed data m·ªõi s·∫Ω ƒë∆∞·ª£c t·∫°o t·ª´ th·ªùi ƒëi·ªÉm t·∫°o n√†y tr·ªü v·ªÅ sau. Ch√∫ng ta c√≥ th·ªÉ l∆∞u tr·ªØ th√¥ng tin data n√†y trong 1 hash table, v·ªõi key l√† UserID v√† value l√† 1 c·∫•u tr√∫c STRUCT gi·ªëng nh∆∞ sau:\nStruct { LinkedHashMap\u0026lt;FeedItemID, FeedItem\u0026gt; feedItems; DateTime lastGenerated; } Ch√∫ng ta c√≥ th·ªÉ l∆∞u tr·ªØ FeedItemIDs trong 1 c·∫•u tr√∫c data structure gi·ªëng nh∆∞ Linked HashMap hay TreeMap, ch√∫ng c√≥ th·ªÉ cho ph√©p ta kh√¥ng ch·ªâ nh·∫£y t·ªõi b·∫•t c·ª© feed item n√†o m√† c√≤n c√≥ th·ªÉ l·∫∑p qua ch√∫ng th√¥ng qua map 1 c√°ch d·ªÖ d√†ng. B·∫•t c·ª© khi n√†o users mu·ªën l·∫•y v·ªÅ nhi·ªÅu feed items h∆°n, ch√∫ng ta c√≥ th·ªÉ g·ª≠i last FeedItemID m√† h·ªç ƒëang nh√¨n th·∫•y trong newsfeed c·ªßa h·ªç, v√† sau ƒë√≥ ta c√≥ th·ªÉ nh·∫£y t·ªõi FeedItemID ƒë√≥ trong hash-map v√† tr·∫£ v·ªÅ batch/page c·ªßa feed items ti·∫øp theo t·ª´ ƒë√≥.\nBao nhi√™u feed items m√† ta n√™n l∆∞u tr·ªØ trong memory cho feed c·ªßa 1 user? Th·ªùi ƒëi·ªÉm kh·ªüi ƒë·∫ßu, ch√∫ng ta c√≥ th·ªÉ quy·∫øt ƒë·ªãnh l∆∞u 500 feed items cho m·ªói user, nh∆∞ng con s·ªë n√†y c√≥ th·ªÉ ƒë∆∞·ª£c ƒëi·ªÅu ch·ªânh sau ƒë√≥ d·ª±a tr√™n m·ª©c s·ª≠ d·ª•ng. V√≠ d·ª•, n·∫øu ta gi·∫£ ƒë·ªãnh 1 page c·ªßa 1 user feed s·∫Ω c√≥ 20 b√†i posts v√† ƒëa s·ªë users kh√¥ng bao gi·ªù duy·ªát tr√™n 10 pages feed c·ªßa h·ªç, ch√∫ng ta c√≥ th·ªÉ quy·∫øt ƒë·ªãnh ch·ªâ l∆∞u tr·ªØ 200 posts tr√™n m·ªói user. V·ªõi b·∫•t c·ª© user ng∆∞·ªùi m√† mu·ªën xem nhi·ªÅu b√†i posts h∆°n (nhi·ªÅu h∆°n nh·ªØng g√¨ l∆∞u trong memory), ch√∫ng ta c√≥ th·ªÉ truy v·∫•n ch√∫ng t·ª´ backend servers.\nCh√∫ng ta n√™n t·∫°o (hay gi·ªØ trong memory) newsfeed cho t·∫•t c·∫£ users? C√≥ r·∫•t nhi·ªÅu users kh√¥ng ƒëƒÉng nh·∫≠p 1 c√°ch th∆∞·ªùng xuy√™n. ƒê√¢y l√† 1 v√†i th·ª© m√† ta c√≥ th·ªÉ l√†m ƒë·ªÉ x·ª≠ l√Ω ƒëi·ªÅu n√†y; 1) 1 c√°ch ti·∫øp c·∫≠n hi·ªÉn nhi√™n nh·∫•t l√† s·ª≠ d·ª•ng 1 LRU cache ƒë·ªÉ x√≥a users kh·ªèi memory do h·ªç kh√¥ng truy c·∫≠p newsfeed c·ªßa h·ªç trong 1 kho·∫£ng th·ªùi gian d√†i. 2) 1 c√°ch ti·∫øp c·∫≠n th√¥ng minh h∆°n l√† t√¨m ra ki·ªÉu ƒëƒÉng nh·∫≠p c·ªßa users ƒë·ªÉ t·∫°o ra c√°c newsfeed c·ªßa h·ªç tr∆∞·ªõc, v√≠ d·ª• th·ªùi ƒëi·ªÉm n√†o trong ng√†y 1 user ho·∫°t ƒë·ªông v√† nh·ªØng ng√†y n√†o trong tu·∫ßn m√† user c√≥ th·ªÉ truy c·∫≠p newsfeed c·ªßa h·ªç?\n","permalink":"https://lifesucks.dev/posts/grokking-system-design-interviews/designing-facebooks-newsfeed/","summary":"1. Facebook newsfeed l√† g√¨? 1 Newsfeed l√† 1 danh s√°ch c√°c b√†i stories ƒë∆∞·ª£c c·∫≠p nh·∫≠t li√™n t·ª•c n·∫±m ch√≠nh gi·ªØa trang Facebook‚Äôs homepage. N√≥ bao g·ªìm c√°c c·∫≠p nh·∫≠t li√™n quan t·ªõi tr·∫°ng th√°i status, photos, videos, links, app activity hay c√°c likes t·ª´ nh·ªØng ng∆∞·ªùi, trang pages, hay groups m√† ng∆∞·ªùi d√πng user theo d√µi follow tr√™n Facebook.\nV·ªõi b·∫•t c·ª© h·ªá th·ªëng m·∫°ng x√£ h·ªôi n√†o m√† b·∫°n thi·∫øt k·∫ø nh∆∞ Twitter, Instagram, hay Facebook th√¨ b·∫°n s·∫Ω c·∫ßn 1 h·ªá th·ªëng ki·ªÉu Newsfeed ƒë·ªÉ hi·ªán th·ªã c√°c th√¥ng tin c·∫≠p nh·∫≠t t·ª´ nh·ªØng ng∆∞·ªùi b·∫°n v√† nh·ªØng ng∆∞·ªùi m√† b·∫°n theo d√µi.","title":"B√†i 13: C√°ch thi·∫øt k·∫ø  Facebook Newsfeed"},{"content":"R·∫•t nhi·ªÅu k·ªπ s∆∞ ph·∫ßn m·ªÅm c·∫£m th·∫•y qu√° s·ª©c trong c√°c cu·ªôc ph·ªèng v·∫•n system design interviews (SDIs) b·ªüi v√¨ 3 lys do ch√≠nh sau:\n Do c√°c c√¢u h·ªèi th∆∞·ªùng kh√¥ng c√≥ c·∫•u tr√∫c ch·∫∑t ch·ªÖ trong c√°c bu·ªïi ph·ªèng v·∫•n SDIs, c√°c c√¢u h·ªèi n√†y ƒëa ph·∫ßn l√† h·ªèi v·ªÅ gi·∫£i ph√°p thi·∫øt k·∫ø ƒë·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ t·ª´ ƒë·∫ßu t·ªõi cu·ªëi v√† th∆∞·ªùng kh√¥ng b√≥ h·∫πp b·ªüi 1 c√¢u tr·∫£ l·ªùi ƒë√∫ng. Vi·ªác thi·∫øu kinh nghi·ªám c·ªßa ch√≠nh b·∫£n th√¢n h·ªç trong vi·ªác ph√°t tri·ªÉn x√¢y d·ª±ng h·ªá th·ªëng large scale systems. H·ªç th∆∞·ªùng thi·∫øu chu·∫©n b·ªã cho c√°c cu·ªôc ph·ªèng v·∫•n SDIs.  Kh√¥ng gi·ªëng nh∆∞ c√°c cu·ªôc ph·ªèng v·∫•n coding interviews, c√°c ·ª©ng vi√™n th∆∞·ªùng kh√¥ng c√≥ ch·ªß ƒë·ªãnh chu·∫©n b·ªã cho c√°c cu·ªôc ph·ªèng v·∫•n SDIs, ƒëa s·ªë h·ªç th∆∞·ªùng x·ª≠ l√Ω kh√¥ng t·ªët trong c√°c cu·ªôc ph·ªèng v·∫•n n√†y, ƒë·∫∑c bi·ªát ·ªü c√°c c√¥ng ty nh∆∞ Google, Facebook, Amazon, Microsoft, etc. ·ªû nh·ªØng c√¥ng ty n√†y, c√°c ·ª©ng vi√™n th∆∞·ªùng x·ª≠ l√Ω d∆∞·ªõi m·ª©c trung b√¨nh ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c c∆° h·ªôi hi·∫øm c√≥, l√† nh·∫≠n ƒë∆∞·ª£c 1 offer nh∆∞ mong ƒë·ª£i. Ng∆∞·ª£c l·∫°i, nh·ªØng ·ª©ng vi√™n x·ª≠ l√Ω t·ªët trong cu·ªôc ph·ªèng v·∫•n, s·∫Ω lu√¥n nh·∫≠n ƒë∆∞·ª£c k·∫øt q·ªßa t·ªët v·ªõi m·ª©c offer t·ªët h∆°n (v·ªã tr√≠ v√† m·ª©c thu nh·∫≠p cao h∆°n) do cu·ªôc ph·ªèng v·∫•n s·∫Ω ch·ªâ ra kh·∫£ nƒÉng c·ªßa ·ª©ng vi√™n trong vi·ªác x√¢y d·ª±ng 1 h·ªá th·ªëng ph·ª©c t·∫°p.\nTrong b√†i h·ªçc n√†y, ch√∫ng ta s·∫Ω tu√¢n theo c√°c b∆∞·ªõc ti·∫øp c·∫≠n sau ƒë·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ v·ªÅ thi·∫øt k·∫ø. B∆∞·ªõc ƒë·∫ßu ti√™n, ta c·∫ßn ƒëi qua c√°c b∆∞·ªõc sau:\nB∆∞·ªõc 1: l√†m r√µ c√°c y√™u c·∫ßu Requirements Lu√¥n l√† 1 √Ω t∆∞·ªüng t·ªët khi ta ƒë·∫∑t c√¢u h·ªèi v·ªÅ ch√≠nh x√°c ph·∫°m vi scope c·ªßa v·∫•n ƒë·ªÅ m√† ta ƒëang gi·∫£i quy·∫øt. C√°c c√¢u h·ªèi v·ªÅ thi·∫øt k·∫ø th∆∞·ªùng l√† c√°c c√¢u h·ªèi gi·∫£i quy·∫øt 1 v·∫•n ƒë·ªÅ t·ª´ ƒë·∫ßu t·ªõi cu·ªëi, v√† ch√∫ng th∆∞·ªùng kh√¥ng ch·ªâ c√≥ 1 c√¢u tr·∫£ l·ªùi ƒë√∫ng. ƒê√¢y l√† l√Ω do t·∫°i sao vi·ªác c·∫ßn l√†m r√µ c√°c y√™u c·∫ßu m∆° h·ªì t·ª´ s·ªõm trong bu·ªïi ph·ªèng v·∫•n, l√† ƒëi·ªÅu h·∫øt s·ª©c quan tr·ªçng. C√°c ·ª©ng vi√™n n√™n d√†nh ƒë·ªß th·ªùi gian ƒë·ªÉ ƒë·ªãnh nghƒ©a ra m·ª•c ti√™u cu·ªëi c·ªßa h·ªá th·ªëng, s·∫Ω c√≥ c∆° h·ªôi t·ªë t h∆°n ƒë·ªÉ th√†nh c√¥ng trong cu·ªôc ph·ªèng v·∫•n. Do ch√∫ng ta ch·ªâ c√≥ t·∫ßm 35-40 ph√∫t ƒë·ªÉ thi·∫øt k·∫ø 1 h·ªá th·ªëng large system, n√™n ch√∫ng ta ph·∫£i l√†m r√µ nh·ªØng th√†nh ph·∫ßn c·∫•u th√†nh n√™n h·ªá th·ªëng m√† ta ƒëang t·∫≠p trung v√†o thi·∫øt k·∫ø.\nCh√∫ng ta s·∫Ω ƒëi s√¢u v√†o v·∫•n ƒë·ªÅ n√†y v·ªõi 1 v√≠ d·ª• c·ª• th·ªÉ l√† thi·∫øt k·∫ø 1 Twitter-like service. ƒê√¢y l√† 1 v√†i c√¢u h·ªèi d√†nh cho vi·ªác thi·∫øt k·∫ø Twitter c·∫ßn ƒë∆∞·ª£c tr·∫£ l·ªùi tr∆∞·ªõc khi ta chuy·ªÉn sang b∆∞·ªõc ti·∫øp theo:\n Ng∆∞·ªùi d√πng users c·ªßa service c√≥ kh·∫£ nƒÉng post tweets v√† theo d√µi follow nh·ªØng ng∆∞·ªùi kh√°c? H·ªá th·ªëng c√≥ t·∫°o v√† hi·ªán th·ªã ra timeline c·ªßa user? Tweets c√≥ ch·ª©a photos v√† videos? Ch·ªâ t·∫≠p trung thi·∫øt k·∫ø backend, c√≥ c·∫ßn thi·∫øt k·∫ø front-end? Ng∆∞·ªùi d√πng users c√≥ th·ªÉ t√¨m ki·∫øm tweets? H·ªá th·ªëng c√≥ hi·ªán th·ªã ra c√°c hot trending topics? C√≥ t√≠nh nƒÉng push notification cho c√°c tweets m·ªõi hay l√† quan tr·ªçng?  T·∫•t c·∫£ c√¢u h·ªèi n√†y s·∫Ω ƒë·ªãnh h√¨nh c√°c ta thi·∫øt k·∫ø h·ªá th·ªëng.\nB∆∞·ªõc 2: ∆Ø·ªõc l∆∞·ª£ng/ƒë·ªãnh l∆∞·ª£ng h·ªá th·ªëng C≈©ng lu√¥n l√† 1 √Ω t∆∞·ªüng t·ªët l√† vi·ªác ƒë·ªãnh l∆∞·ª£ng t√≠nh m·ªü r·ªông c·ªßa h·ªá th·ªëng m√† ch√∫ng ta ƒëang thi·∫øt k·∫ø. ƒêi·ªÅu n√†y s·∫Ω gi√∫p ch√∫ng ta t·∫≠p chung v√†o vi·ªác m·ªü r·ªông scaling, ph√¢n t√°n partitioning, c√¢n b·∫±ng t·∫£i load balancing, caching:\n T√≠nh m·ªü r·ªông m√† h·ªá th·ªëng k·ª≥ v·ªçng (v√≠ d·ª•: s·ªë l∆∞·ª£ng c√°c new tweets, s·ªë l∆∞·ª£t view tweet views, s·ªë l∆∞·ª£ng t·∫°o timeline generations tr√™n m·ªói gi√¢y)? S·ªë l∆∞·ª£ng l∆∞u tr·ªØ storage m√† h·ªá th·ªëng c·∫ßn? Ch√∫ng ta c√≥ c√°c y√™u c·∫ßu v·ªÅ l∆∞u tr·ªØ storage requirements kh√°c nhau n·∫øu ng∆∞·ªùi d√πng users c√≥ th·ªÉ c√≥ photos v√† videos trong tweets c·ªßa h·ªç. L∆∞u l∆∞·ª£ng bƒÉng th√¥ng network bandwidth m√† h·ªá th·ªëng k·ª≥ v·ªçng? ƒê√¢y s·∫Ω l√† ƒëi·ªÉm quan tr·ªçng trong vi·ªác ta quy·∫øt ƒë·ªãnh qu·∫£n l√Ω traffic v√† c√¢n b·∫±ng t·∫£i balance load gi·ªØa c√°c servers.  B∆∞·ªõc 3: C√°c ƒë·ªãnh nghƒ©a System interface definition ƒê·ªãnh nghƒ©a nh·ªØng APIs s·∫Ω c√≥ trong h·ªá th·ªëng. ƒêi·ªÅu n√†y s·∫Ω x√°c l·∫≠p ra ch√≠nh x√°c c√°c ch·ª©c nƒÉng h·ªá th·ªëng v√† ƒë·∫£m b·∫£o r·∫±ng ch√∫ng ta kh√¥ng l√†m sai b·∫•t k·ª≥ y√™u c·∫ßu n√†o c·ªßa h·ªá th·ªëng. 1 v√†i v√≠ d·ª• v·ªÅ APIs d√†nh cho Twitter-like service nh∆∞ sau:\npostTweet(user_id, tweet_data, tweet_location, user_location, timestamp, ‚Ä¶) generateTimeline(user_id, current_time, user_location, ‚Ä¶) markTweetFavorite(user_id, tweet_id, timestamp, ‚Ä¶) B∆∞·ªõc 4: ƒê·ªãnh nghƒ©a data model Vi·ªác ƒë·ªãnh nghƒ©a data model c≈©ng thu·ªôc c√°c b∆∞·ªõc ƒë·∫ßu ti√™n trong cu·ªôc ph·ªèng v·∫•n, c≈©ng c·∫ßn l√†m r√µ c√°c lu·ªìng data flow gi·ªØa c√°c th√†nh ph·∫ßn kh√°c nhau c·ªßa h·ªá th·ªëng. Sau khi l√†m r√µ b∆∞·ªõc n√†y, th√¨ ƒëi·ªÅu n√†y s·∫Ω ƒë·ªãnh h∆∞·ªõng cho ta c√°ch qu·∫£n l√Ω v√† ph√¢n v√πng d·ªØ li·ªáu. C√°c ·ª©ng vi√™n n√™n ƒë·ªãnh nghƒ©a r√µ ra c√°c th√†nh ph·∫ßn h·ªá th·ªëng kh√°c nhau, c√°ch ch√∫ng t∆∞∆°ng t√°c v·ªõi th√†nh ph·∫ßn kh√°c, v√† c√°c kh√≠a c·∫°nh kh√°c nhau c·ªßa vi·ªác qu·∫£n l√Ω d·ªØ li·ªáu nh∆∞ l∆∞u tr·ªØ storage, lu√¢n chuy·ªÉn transportation, m√£ h√≥a encryption. ƒê√¢y l√† 1 v√†i th√†nh ph·∫ßn kh√°c nhau d√†nh cho Twitter-like service:\n User: UserID, Name, Email, DoB, CreationDate, LastLogin, etc. Tweet: TweetID, Content, TweetLocation, NumberOfLikes, TimeStamp, etc. UserFollow: UserID1, UserID2 FavoriteTweets: UserID, TweetID, TimeStamp  Lo·∫°i database n√†o m√† ch√∫ng ta n√™n s·ª≠ d·ª•ng? C√≥ ph·∫£i NoSQL nh∆∞ Cassandra ph√π h·ª£p v·ªõi y√™u c·∫ßu m√† ta c·∫ßn, hay ta s·ª≠ d·ª•ng 1 gi·∫£i ph√°p d·ª±a tr√™n MYSQL? Lo·∫°i l∆∞u tr·ªØ block storage n√†o m√† ta n√™n s·ª≠ d·ª•ng ƒë·ªÉ l∆∞u tr·ªØ photos v√† videos?\nB∆∞·ªõc 5: High-level design Th·ª±c hi·ªán v·∫Ω ra c√°c bi·ªÉu ƒë·ªì diagram ƒë·ªÉ bi·ªÉu di·ªÖn ra c√°c th√†nh ph·∫ßn core c·ªßa h·ªá th·ªëng. Ch√∫ng ta n√™n x√°c ƒë·ªãnh ƒë·ªß c√°c th√†nh ph·∫ßn components c·∫ßn c√≥ ƒë·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ th·ª±c s·ª± end to end.\nƒê·ªëi v·ªõi Twitter, ·ªü m·ª©c high level, ta s·∫Ω c·∫ßn nhi·ªÅu application servers ƒë·ªÉ ph·ª•c v·ª• c√°c read/write requests v·ªõi c√¢n b·∫±ng t·∫£i load balancers ·ªü tr∆∞·ªõc ch√∫ng ƒë·ªÉ ph√¢n ph·ªëi traffic. Gi·∫£ s·ª≠ r·∫±ng ch√∫ng ta s·∫Ω c√≥ nhi·ªÅu read traffic h∆°n so v·ªõi write, ta c√≥ th·ªÉ quy·∫øt ƒë·ªãnh ph√¢n t√°ch servers ri√™ng r·∫Ω x·ª≠ l√Ω trong ng·ªØ c·∫£nh n√†y. ·ªû ph√≠a back-end, ta c·∫ßn c√≥ 1 database hi·ªáu qu·∫£ c√≥ th·ªÉ l∆∞u tr·ªØ to√†n b·ªô tweets v√† h·ªó tr·ª£ ƒë∆∞·ª£c l∆∞·ª£ng l·ªõn large number of reads. Ta c≈©ng s·∫Ω c·∫ßn 1 h·ªá th·ªëng l∆∞u tr·ªØ file ph√¢n t√°n distributed file storage system cho vi·ªác l∆∞u tr·ªØ photos v√† videos.\nB∆∞·ªõc 6: Detailed design Ph√¢n t√≠ch s√¢u h∆°n v√†o 2 hay 3 th√†nh ph·∫ßn ch√≠nh c·ªßa h·ªá th·ªëng; D·ª±a v√†o ph·∫£n h·ªìi c·ªßa ng∆∞·ªùi ph·ªèng v·∫•n, h·ªç s·∫Ω ch·ªâ r√µ cho ta nh·ªØng th√†nh ph·∫ßn n√†o c·∫ßn th·∫£o lu·∫≠n th√™m. Ch√∫ng ta n√™n tr√¨nh b√†y c√°c h∆∞·ªõng ti·∫øp c·∫≠n kh√°c nhau, ƒë∆∞a ra ∆∞u v√† nh∆∞·ª£c ƒëi·ªÉm c·ªßa ch√∫ng, v√† gi·∫£i th√≠ch t·∫°i sao ta l·∫°i l·ª±a ch·ªçn c√°ch ti·∫øp c·∫≠n n√†y h∆°n c√°i kh√°c. Nh·ªõ r·∫±ng, kh√¥ng c√≥ 1 c√¢u tr·∫£ l·ªùi ƒë√∫ng duy nh·∫•t, lu√¥n c√≥ 1 th·ª© quan tr·ªçng ph·∫£i x√©t ƒë·∫øn l√† s·ª± c√¢n b·∫±ng tradeoffs gi·ªØa c√°c l·ª±a ch·ªçn kh√°c nhau d·ª±a tr√™n c√°c r√†ng bu·ªôc c·ªßa h·ªá th·ªëng:\n Do ch√∫ng ta s·∫Ω l∆∞u tr·ªØ 1 l∆∞·ª£ng l·ªõn d·ªØ li·ªáu, n√™n ta s·∫Ω th·ª±c hi·ªán ph√¢n t√°n d·ªØ li·ªáu ph√¢n t√°n ra nhi·ªÅu databases? ta n√™n l∆∞u tr·ªØ to√†n b·ªô d·ªØ li·ªáu c·ªßa 1 user tr√™n c√πng 1 database? V·∫•n ƒë·ªÅ issue g√¨ c√≥ th·ªÉ x·∫£y ra? C√°ch ta x·ª≠ l√Ω nh·ªØng hot users khi h·ªç tweet r·∫•t nhi·ªÅu hay follow r·∫•t nhi·ªÅu ng∆∞·ªùi kh√°c? Do timeline c·ªßa user s·∫Ω ch·ª©a c√°c tweets g·∫ßn ƒë√¢y, ta c√≥ n√™n th·ª≠ l∆∞u tr·ªØ d·ªØ li·ªáu n√†y ƒë·ªÉ t·ªëi ∆∞u h√≥a cho vi·ªác truy v·∫•n l·∫•y ra latest tweets? Bao nhi√™u v√† nh·ªØng layer n√†o m√† ch√∫ng ta d√πng ƒë·ªÉ cache ƒë·ªÉ tƒÉng t·ªëc? Nh·ªØng components n√†o c·∫ßn ƒë∆∞·ª£c load balancing?  B∆∞·ªõc 7: C√°ch x√°c ƒë·ªãnh v√† gi·∫£i quy·∫øt c√°c n√∫t c·ªï chai bottlenecks Th·ª±c hi·ªán ƒë·ªÅ c·∫≠p t·ªõi nhi·ªÅu c√°c n√∫t c·ªï chai bottlenecks nhi·ªÅu nh·∫•t c√≥ th·ªÉ v√† c√°c c√°ch ti·∫øp c·∫≠n kh√°c nhau ƒë·ªÉ gi·∫£m thi·ªÉu ch√∫ng:\n H·ªá th·ªëng c√≥ t·ªìn t·∫°i ƒëi·ªÉm single point of failure n√†o kh√¥ng? Ch√∫ng ta s·∫Ω l√†m g√¨ ƒë·ªÉ g·ªâam thi·ªÉu ƒë∆∞·ª£c ch√∫ng? Ch√∫ng ta c√≥ ƒë·ªß s·ªë replicas c·ªßa d·ªØ li·ªáu v√† h·ªá th·ªëng v·∫´n ch·∫°y ƒë√°p ·ª©ng ng∆∞·ªùi d√πng n·∫øu c√≥ 1 v√†i servers g·∫∑p l·ªói? T∆∞∆°ng t·ª±, ch√∫ng ta c√≥ ƒë·ªß s·ªë copies c·ªßa c√°c services kh√°c nhau ƒëang ch·∫°y m√† 1 v√†i trong s·ªë ch√∫ng g·∫∑p l·ªói th√¨ kh√¥ng g√¢y ra shutdown to√†n b·ªô h·ªá th·ªëng? C√°ch ch√∫ng ta gi√°m s√°t hi·ªáu nƒÉng c·ªßa c√°c services? Ch√∫ng ta ƒë√£ c√≥ nh·ªØng c·∫£nh b√°o b·∫•t c·ª© khi n√†o c√°c th√†nh ph·∫ßn quan tr·ªçng c·ªßa h·ªá th·ªëng g·∫∑p l·ªói hay g·∫∑p v·∫•n ƒë·ªÅ v·ªÅ hi·ªáu nƒÉng?  T·ªïng k·∫øt Ng·∫Øn g·ªçn, vi·ªác chu·∫©n b·ªã c√≥ ch·ªß ƒë·ªãnh khi th·ª±c hi·ªán ph·ªèng v·∫•n s·∫Ω l√† ch√¨a kh√≥a ƒë·ªÉ gi√∫p b·∫°n th√†nh c√¥ng trong bu·ªïi ph·ªèng v·∫•n system design interviews. C√°c b∆∞·ªõc ·ªü tr√™n s·∫Ω h∆∞·ªõng d·∫´n b·∫°n ƒëi ƒë√∫ng h∆∞·ªõng v√† bao qu√°t ƒë∆∞·ª£c c√°c c√°ch ti·∫øp c·∫≠n kh√°c nhau khi thi·∫øt k·∫ø h·ªá th·ªëng.\n","permalink":"https://lifesucks.dev/posts/grokking-system-design-interviews/system-design-interviews-a-step-by-step-guide/","summary":"R·∫•t nhi·ªÅu k·ªπ s∆∞ ph·∫ßn m·ªÅm c·∫£m th·∫•y qu√° s·ª©c trong c√°c cu·ªôc ph·ªèng v·∫•n system design interviews (SDIs) b·ªüi v√¨ 3 lys do ch√≠nh sau:\n Do c√°c c√¢u h·ªèi th∆∞·ªùng kh√¥ng c√≥ c·∫•u tr√∫c ch·∫∑t ch·ªÖ trong c√°c bu·ªïi ph·ªèng v·∫•n SDIs, c√°c c√¢u h·ªèi n√†y ƒëa ph·∫ßn l√† h·ªèi v·ªÅ gi·∫£i ph√°p thi·∫øt k·∫ø ƒë·ªÉ gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ t·ª´ ƒë·∫ßu t·ªõi cu·ªëi v√† th∆∞·ªùng kh√¥ng b√≥ h·∫πp b·ªüi 1 c√¢u tr·∫£ l·ªùi ƒë√∫ng.","title":"B√†i 1: C√°c b∆∞·ªõc ƒë·ªÉ tr·∫£ l·ªùi ƒë∆∞·ª£c ph·ªèng v·∫•n System Design Interviews"},{"content":"1. T·∫°i sao ch√∫ng ta c·∫ßn 1 d·ªãch v·ª• ki·ªÉu l√†m ng·∫Øn URL shortening? URL shortening ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o ra c√°c ƒë·ªãnh danh ng·∫Øn g·ªçn h∆°n shorter aliases cho c√°c URLs d√†i d√≤ng. Ch√∫ng ta g·ªçi c√°c ƒë·ªãnh danh ƒë∆∞·ª£c l√†m ng·∫Øn n√†y l√† c√°c \u0026ldquo;short links.\u0026rdquo;. C√°c users ƒë∆∞·ª£c ƒëi·ªÅu h∆∞·ªõng t·ªõi URL g·ªëc khi h·ªç th·ª±c hi·ªán truy c·∫≠p v√†o c√°c short links n√†y. C√°c short links s·∫Ω ti·∫øt ki·ªám nhi·ªÅu kh√¥ng gian khi hi·ªán th·ªã, in ·∫•n, truy·ªÅn th√¥ng ƒëi·ªáp hay tweeted. Th√™m n·ªØa, c√°c users th∆∞·ªùng hi·∫øm khi g√µ sai khi th·ª±c hi·ªán g√µ c√°c URLs ƒë∆∞·ª£c l√†m ng·∫Øn g·ªçn l·∫°i.\nV√≠ d·ª•, n·∫øu ch√∫ng ta l√†m ng·∫Øn URL sau th√¥ng qua TinyURL:\nhttps://www.educative.io/courses/grokking-the-system-design-interview/m2ygV4E81AR Ch√∫ng ta s·∫Ω nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£:\nhttps://tinyurl.com/rxcsyr3r URL ƒë∆∞·ª£c l√†m ng·∫Øn ch·ªâ b·∫±ng 1 ph·∫ßn 3 so v·ªõi URL g·ªëc. H·ªá th·ªëng URL shortening ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·ªëi ∆∞u links th√¥ng qua nhi·ªÅu thi·∫øt b·ªã devices, c√≥ th·ªÉ track ƒë∆∞·ª£c c√°c links c·ª• th·ªÉ ƒë·ªÉ ph√¢n t√≠ch audience, ƒëo l∆∞·ªùng hi·ªáu qu·∫£ c·ªßa chi·∫øn d·ªãch qu·∫£ng c√°o, hay d√πng ƒë·ªÉ ·∫©n ƒëi URLs g·ªëc.\nN·∫øu b·∫°n ch∆∞a t·ª´ng s·ª≠ d·ª•ng tinyurl.com tr∆∞·ªõc ƒë√¢y, b·∫°n n√™n th·ª≠ t·∫°o ra 1 shortened URL v√† b·ªè th·ªùi gian ƒë·ªÉ s·ª≠ d·ª•ng 1 s·ªë options kh√°c nhau do d·ªãch v·ª• cung c·∫•p. N√≥ s·∫Ω gi√∫p b·∫°n hi·ªÉu v·ªÅ ch∆∞∆°ng n√†y.\n2. Y√™u c·∫ßu v√† m·ª•c ti√™u c·ªßa h·ªá th·ªëng  B·∫°n ph·∫£i lu√¥n lu√¥n l√†m r√µ c√°c y√™u c·∫ßu ngay t·ª´ th·ªùi ƒëi·ªÉm b·∫Øt ƒë·∫ßu c·ªßa bu·ªïi ph·ªèng v·∫•n. V√† ƒë·∫£m b·∫£o ch·∫Øc ch·∫Øn r·∫±ng ƒë·∫∑t ra c√°c c√¢u h·ªèi ƒë·ªÉ t√¨m ra ch√≠nh x√°c ph·∫°m vi scope c·ªßa h·ªá th·ªëng.\n H·ªá th·ªëng URL shortening system s·∫Ω c√≥ c√°c y√™u c·∫ßu nh∆∞ sau: C√°c y√™u c·∫ßu v·ªÅ m·∫∑t t√≠nh nƒÉng:\n ƒê∆∞a ra 1 URL, d·ªãch v·ª• c·ªßa ch√∫ng ta s·∫Ω t·∫°o ra 1 ƒë·ªãnh danh ng·∫Øn h∆°n v√† duy nh·∫•t cho n√≥. ƒê·ªãnh danh n√†y ƒë∆∞·ª£c g·ªçi l√† 1 short link. Link n√†y ƒë∆∞·ª£c l√†m ng·∫Øn g·ªçn ƒë·ªß ƒë·ªÉ d·ªÖ d√†ng khi th·ª±c hi·ªán copied v√† pasted v√†o trong c√°c ·ª©ng d·ª•ng applications. Khi users truy c·∫≠p 1 short link, d·ªãch v·ª• c·ªßa ch√∫ng ta s·∫Ω ƒëi·ªÅu h∆∞·ªõng h·ªç t·ªõi link g·ªëc. C√°c users c√≥ th·ªÉ t√πy ch·ªçn c·∫•u h√¨nh t√πy ch·ªânh custom short link cho URL c·ªßa h·ªç. C√°c links s·∫Ω b·ªã h·∫øt h·∫°n sau 1 kho·∫£ng th·ªùi gian. C√°c users c√≥ th·ªÉ ƒë·ªãnh nghƒ©a ƒë∆∞·ª£c th·ªùi gian h·∫øt h·∫°n n√†y.  C√°c y√™u c·∫ßu kh√¥ng li√™n quan t·ªõi t√≠nh nƒÉng:\n H·ªá th·ªëng ph·∫£i c√≥ t√≠nh s·∫µn s√†ng cao. ƒê√¢y l√† y√™u c·∫ßu b·∫Øt bu·ªôc b·ªüi v√¨ khi h·ªá th·ªëng b·ªã down, th√¨ t·∫•t c·∫£ c√°c chuy·ªÉn h∆∞·ªõng URL s·∫Ω g·∫∑p l·ªói. Chuy·ªÉn h∆∞·ªõng URL n√™n x·∫£y ra theo th·ªùi gian th·ª±c v·ªõi ƒë·ªô tr·ªÖ th·∫•p. C√°c Shortened links n√™n ƒë∆∞·ª£c t·∫°o ra 1 c√°ch b·∫•t ƒë·ªãnh (kh√≥ ƒëo√°n tr∆∞·ªõc).  C√°c y√™u c·∫ßu m·ªü r·ªông:\n Ph√¢n t√≠ch Analytics, v√≠ d·ª• 1 url ƒë∆∞·ª£c chuy·ªÉn h∆∞·ªõng bao nhi√™u l·∫ßn? D·ªãch v·ª• n√™n ƒë∆∞·ª£c truy c·∫≠p ƒë∆∞·ª£c th√¥ng qua REST APIs b·ªüi c√°c services kh√°c.  3. ƒê·ªãnh l∆∞·ª£ng s·ª©c ch·ª©a v√† c√°c r√†ng bu·ªôc H·ªá th·ªëng c·ªßa ta s·∫Ω n·∫∑ng v·ªÅ read. S·∫Ω c√≥ r·∫•t nhi·ªÅu chuy·ªÉn h∆∞·ªõng redirection requests so v·ªõi c√°c new URL shortenings. Ta gi·∫£i ƒë·ªãnh t·ªâ l·ªá n√†y kho·∫£ng 100:1 gi·ªØa read v√† write.\nƒê·ªãnh l∆∞·ª£ng traffic: Gi·∫£ s·ª≠, ch√∫ng ta s·∫Ω c√≥ 500M new URL shortenings m·ªõi m·ªói th√°ng, v·ªõi t·ªâ l·ªá 100:1 read/write, ta k√¨ v·ªçng c√≥ 50B (50 t·ª∑) chuy·ªÉn h∆∞·ªõng redirections v·ªõi c√πng chu k·ª≥:\n100*500M =\u0026gt; 50B S·ªë l∆∞·ª£ng truy v·∫•n tr√™n gi√¢y Queries Per Second (QPS) l√† bao nhi√™u? New URLs shortenings ƒë∆∞·ª£c l√†m ng·∫Øn tr√™n m·ªói gi√¢y:\n500 million / (30 days * 24 hours * 3600 seconds) = ~200 URLs/s X√©t t·ªõi t·ªâ l·ªá 100:1 read/write, URLs redirections tr√™n m·ªói gi√¢y s·∫Ω l√†:\n100 * 200 URLs/s = 20K/s ƒê·ªãnh l∆∞·ª£ng l∆∞u tr·ªØ storage: Gi·∫£ s·ª≠ ta l∆∞u tr·ªØ m·ªçi URL shortening request (bao g·ªìm c·∫£ shortened link t∆∞∆°ng ·ª©ng v·ªõi n√≥) trong v√≤ng 5 nƒÉm. Do ta k·ª≥ v·ªçng c√≥ 500M new URLs m·ªói th√°ng, th√¨ t·ªïng s·ªë objects m√† ta k·ª≥ v·ªçng l∆∞u tr·ªØ l√† 30B (30 t·ª∑):\n500 million * 5 years * 12 months = 30 billion Ta gi·∫£ ƒë·ªãnh m·ªói object ƒë∆∞·ª£c l∆∞u tr·ªØ m·∫•t x·∫•p x·ªâ 500 bytes. Ta s·∫Ω c·∫ßn 15TB l∆∞u tr·ªØ storage:\n30 billion * 500 bytes = 15 TB ƒê·ªãnh l∆∞·ª£ng bƒÉng th√¥ng Bandwidth: V·ªõi c√°c write requests, do ch√∫ng ta k·ª≥ v·ªçng 200 new URLs tr√™n m·ªói gi√¢y, t·ªïng s·ªë d·ªØ li·ªáu incoming data s·∫Ω kho·∫£ng 100KB tr√™n gi√¢y:\n200 * 500 bytes = 100 KB/s V·ªõi c√°c read requests, do m·ªói gi√¢y ra k·ª≥ v·ªçng ~ 20K chuy·ªÉn h∆∞·ªõng URLs redirections, t·ªïng s·ªë d·ªØ li·ªáu outgoing data s·∫Ω kho·∫£ng 10MB tr√™n gi√¢y:\n20K * 500 bytes = ~10 MB/s ƒê·ªãnh l∆∞·ª£ng memory: N·∫øu ta mu·ªën cache 1 v√†i hot URLs m√† th∆∞·ªùng xuy√™n ƒë∆∞·ª£c truy c·∫≠p, s·ªë l∆∞·ª£ng memory v√† ta c·∫ßn ƒë·ªÉ l∆∞u tr·ªØ ch√∫ng l√† bao nhi√™u? N·∫øu ta tu√¢n theo ƒë·ªãnh lu·∫≠t 80-20 rule, c√≥ nghƒ©a l√† 20% s·ªë URLs s·∫Ω t·∫°o ra 80% traffic, Ch√∫ng ta s·∫Ω mu·ªën cache l·∫°i 20% hot URLs. Do ta c√≥ kho·∫£ng 20K requests tr√™n gi√¢y, ta s·∫Ω c√≥ kho·∫£ng 1.7B (t·ª∑) requests m·ªói ng√†y:\n20K * 3600 seconds * 24 hours = ~1.7 billion Ta s·∫Ω cache l·∫°i 20% s·ªë requests n√†y, ta s·∫Ω c·∫ßn 170GB memory:\n0.2 * 1.7 billion * 500 bytes = ~170GB 1 ƒëi·ªÉm n·ªØa ta c·∫ßn l∆∞u √Ω ·ªü ƒë√¢y l√† s·∫Ω c√≥ nhi·ªÅu duplicate requests t·ªõi c√πng 1 URL, n√™n s·ªë l∆∞·ª£ng memory m√† ta s·ª≠ d·ª•ng s·∫Ω th·∫•p h∆°n 170GB. ƒê·ªãnh l∆∞·ª£ng ·ªü m·ª©c High-level: Gi·∫£ ƒë·ªãnh c√≥ 500M new URLs m·ªói th√°ng v√† t·ª∑ l·ªá 100:1 read:write, b·∫£ng sau ƒë√¢y s·∫Ω ch·ªâ ra ƒë·ªãnh l∆∞·ª£ng t·ªïng quan c·ªßa service:\n   Ch·ªâ s·ªë ƒê·ªãnh l∆∞·ª£ng     New URLS 200/s   URL redirections 20k/s   Incoming data 100KB/s   Outgoing data 10MB/s   Storage for 5 years 15TB   Memory for cache 170GB    4. System APIs  Khi ch√∫ng ta ƒë√£ ho√†n th√†nh vi·ªác l√†m r√µ y√™u c·∫ßu, s·∫Ω lu√¥n l√† 1 √Ω t∆∞·ªüng t·ªët ƒë·ªÉ ƒë·ªãnh nghƒ©a ra c√°c system APIs. Do ƒë√¢y ƒë√∫ng l√† nh·ªØng g√¨ m√† h·ªá th·ªëng k·ª≥ v·ªçng\n Ch√∫ng ta c√≥ th·ªÉ t·∫°o ra SOAP hay REST APIs ƒë·ªÉ l·ªô ra c√°c t√≠nh nƒÉng c·ªßa h·ªá th·ªëng. ƒêo·∫°n m√£ d∆∞·ªõi ƒë√¢y ƒë·ªãnh nghƒ©a APIs d√πng ƒë·ªÉ t·∫°o m·ªõi v√† x√≥a URLs:\ncreateURL(api_dev_key, original_url, custom_alias=None, user_name=None, expire_date=None) C√°c tham s·ªë:\n api_dev_key (string): API developer key c·ªßa 1 account ƒë√£ ƒëƒÉng k√Ω. N√≥ s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng cho nhi·ªÅu m·ª•c ƒë√≠ch kh√°c nh∆∞ vi·ªác gi·ªõi h·∫°n g·ªçi api c·ªßa users d·ª±a tr√™n quota ƒë∆∞·ª£c c·∫•p. original_url (string): URL g·ªëc ƒë∆∞·ª£c l√†m ng·∫Øn custom_alias (string): custom key t√πy ch·ªçn cho URL. user_name (string): t√πy ch·ªçn user name ƒë∆∞·ª£c d√πng ƒë·ªÉ m√£ h√≥a encoding. expire_date (string): t√πy ch·ªçn ng√†y h·∫øt h·∫°n cho shortened URL.  Return:(string) Khi vi·ªác th√™m m·ªõi th√†nh c√¥ng n√≥ s·∫Ω tr·∫£ v·ªÅ shortened URL; m·∫∑t kh√°c n√≥ s·∫Ω tr·∫£ v·ªÅ 1 m√£ l·ªói error code.\ndeleteURL(api_dev_key, url_key) V·ªõi url_key l√† chu·ªói bi·ªÉu th·ªã shortened URL ƒë∆∞·ª£c tr·∫£ v·ªÅ; N·∫øu x√≥a th√†nh c√¥ng s·∫Ω tr·∫£ v·ªÅ \u0026ldquo;URL Removed\u0026rdquo;. C√°ch m√† ta ph√°t hi·ªán v√† ngƒÉn ch·∫∑n vi·ªác l·∫°m quy·ªÅn? ƒê·ªÉ ngƒÉn ch·∫∑n ƒëi·ªÅu n√†y, ta c√≥ th·ªÉ gi·ªõi h·∫°n users th√¥ng qua api_dev_key. M·ªói api_dev_key c√≥ th·ªÉ b·ªã gi·ªõi h·∫°n 1 s·ªë l∆∞·ª£ng t·∫°o URL creations hay chuy·ªÉn h∆∞·ªõng redirections tr√™n 1 kho·∫£ng th·ªùi gian (ƒêi·ªÅu n√†y c√≥ th·ªÉ ƒë∆∞·ª£c thi·∫øt l·∫≠p c√°c kho·∫£ng th·ªùi gian kh√°c nhau tr√™n m·ªói developer key).\n5. Database Design  ƒê·ªãnh nghƒ©a DB schema trong nh·ªØng b∆∞·ªõc ƒë·∫ßu ti√™n c·ªßa bu·ªïi ph·ªèng v·∫•n s·∫Ω gi√∫p hi·ªÉu ƒë∆∞·ª£c v·ªÅ lu·ªìng data flow gi·ªØa c√°c th√†nh ph·∫ßn components kh√°c nhau trong h·ªá th·ªëng v√† t·ª´ ƒë√≥ n√≥ s·∫Ω h∆∞·ªõng ch√∫ng ta t·ªõi vi·ªác quy ho·∫°ch ph√¢n v√πng d·ªØ li·ªáu.\n C√≥ 1 v√†i quan s√°t v·ªÅ b·∫£n ch·∫•t d·ªØ li·ªáu m√† ch√∫ng ta s·∫Ω l∆∞u tr·ªØ nh∆∞ sau:\n Ch√∫ng ta c·∫ßn l∆∞u tr·ªØ h√†ng t·ª∑ b·∫£n ghi. M·ªói object ch√∫ng ta l∆∞u tr·ªØ th∆∞·ªùng r·∫•t nh·ªè (nh·ªè h∆°n 1K). Kh√¥ng c√≥ m·ªëi quan h·ªá relationships gi·ªØa c√°c b·∫£n ghi records\u0026ndash;h∆°n l√† vi·ªác c·∫ßn l∆∞u l·∫°i user n√†o t·∫°o ra URL. Service thi√™n v·ªÅ read.  Database schema Ch√∫ng ta c·∫ßn c√≥ 2 b·∫£ng tables: 1 d√πng ƒë·ªÉ l∆∞u tr·ªØ th√¥ng tin v·ªÅ URL mapping v√† 1 b·∫£ng l∆∞u tr·ªØ v·ªÅ th√¥ng tin user data ng∆∞·ªùi ƒë√£ t·∫°o ra short link.\nLo·∫°i database n√†o m√† ta n√™n s·ª≠ d·ª•ng? Do ta ∆∞·ªõc t√≠nh c·∫ßn l∆∞u tr·ªØ h√†ng t·ª∑ b·∫£n ghi v√† ta kh√¥ng c·∫ßn s·ª≠ d·ª•ng m·ªëi quan h·ªá relationships gi·ªØa c√°c objects - 1 NoSQL gi·ªëng nh∆∞ DynamoDB, Cassandra hay Riak l√† l·ª±a ch·ªçn ph√π h·ª£p. L·ª±a ch·ªçn theo h∆∞·ªõng NoSQL s·∫Ω gi√∫p d·ªÖ d√†ng m·ªü r·ªông scale h∆°n.\n6. Basic System Design v√† Algorithm V·∫•n ƒë·ªÅ m√† ta mu·ªën gi·∫£i quy·∫øt t·∫°i ƒë√¢y l√† c√°ch t·∫°o ra 1 ƒë·ªãnh danh ng·∫Øn g·ªçn v√† duy nh·∫•t cho 1 URL n√†o ƒë√≥. Trong v√≠ d·ª• v·ªÅ TinyURL ·ªü ph·∫ßn 1, shortened URL c√≥ gi√° tr·ªã l√† \u0026ldquo;https://tinyurl.com/rxcsyr3r\u0026quot;. 8 k√≠ t·ª± cu·ªëi trong chu·ªói URL n√†y ch√≠nh l√† ƒë·ªãnh danh m√† ta mu·ªën t·∫°o. Ta s·∫Ω ƒë∆∞a ra 2 gi·∫£i ph√°p t·∫°i ƒë√¢y:\na. M√£ h√≥a URL g·ªëc Ta c√≥ th·ªÉ t·∫°o ra 1 chu·ªói unique hash (MD5 hay SHA256) t·ª´ 1 URL ƒë√£ cho. Chu·ªói hash c√≥ th·ªÉ ƒë∆∞·ª£c m√£ h√≥a l·∫°i cho vi·ªác hi·ªán th·ªã. Chu·ªói m√£ h√≥a encoding n√†y c√≥ th·ªÉ l√† base36 ([a-z ,0-9]) ho·∫∑c base62 ([A-Z, a-z, 0-9]) v√† n·∫øu ta th√™m v√†o c√°c ksi t·ª± \u0026lsquo;+\u0026rsquo; v√† \u0026lsquo;/\u0026rsquo; ta c√≥ th·ªÉ s·ª≠ d·ª•ng base64 encoding. 1 C√¢u h·ªèi c·∫ßn ƒë∆∞·ª£c ƒë·∫∑t ra l√† ƒë·ªô d√†i v·ªÅ ƒë·ªãnh danh short key l√† bao nhi√™u? 6,8,hay 10 k√≠ t·ª±?\nS·ª≠ d·ª•ng m√£ h√≥a base64 encoding, th√¨ v·ªõi 1 ƒë·ªãnh danh c√≥ ƒë·ªô d√†i l√† 6 k√≠ t·ª±, s·∫Ω t·∫°o ra ƒë∆∞·ª£c 64^6 = ~68.7 t·ª∑ ƒë·ªãnh danh. S·ª≠ d·ª•ng m√£ h√≥a base64 encoding, th√¨ v·ªõi 1 ƒë·ªãnh danh c√≥ ƒë·ªô d√†i l√† 8 k√≠ t·ª±, s·∫Ω t·∫°o ra ƒë∆∞·ª£c 64^8 = ~281 t·ª∑ t·ª∑ ƒë·ªãnh danh.\nV·ªõi 68.7B unique strings, ch√∫ng ta gi·∫£ ƒë·ªãnh l√† ƒë·ªãnh danh c√≥ ƒë·ªô d√†i l√† 6 k√≠ t·ª± l√† ƒë·ªß cho h·ªá th·ªëng m√† ta ƒëang x√¢y d·ª±ng.\nN·∫øu ta s·ª≠ d·ª•ng thu·∫≠t to√°n MD5 algorithm hay c√°c hash function, n√≥ s·∫Ω t·∫°o ra chu·ªói hash c√≥ gi√° tr·ªã 128-bit. Sau khi m√£ h√≥a base64 encoding, ta s·∫Ω nh·∫≠n ƒë∆∞·ª£c 1 chu·ªói string c√≥ nhi·ªÅu h∆°n 21 k√≠ t·ª± (do m·ªói 1 k√≠ t·ª± base64 s·∫Ω m√£ h√≥a 6 bits c·ªßa chu·ªói hash). D√π ta l∆∞·∫° ch·ªçn ƒë·ªãnh danh key c√≥ ƒë·ªô d√†i l√† 6 hay 8, th√¨ ta v·∫´n g·∫∑p ph·∫£i v·∫•n ƒë·ªÅ l√† tr√πng l·∫∑p key; ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y, ta c√≥ th·ªÉ l·ª±a ch·ªçn 1 v√†i k√≠ t·ª± kh√°c n·∫±m ngo√†i c√°c chu·ªói k√≠ t·ª± d√πng ƒë·ªÉ m√£ h√≥a.\nNh·ªØng issues n√†o ta s·∫Ω ph·∫£i ƒë·ªëi m·∫∑t? Ch√∫ng ta s·∫Ω ƒë·ªëi m·∫∑t v·ªõi 2 v·∫•n ƒë·ªÅ v·ªõi gi·∫£i ph√°p m√£ h√≥a encoding:\n N·∫øu c√≥ nhi·ªÅu users c√πng nh·∫≠p v√†o c√πng 1 URL, th√¨ h·ªç s·∫Ω l·∫•y ra c√πng 1 shortened URL, ƒëi·ªÅu n√†y l√† kh√¥ng th·ªÉ ch·∫•p nh·∫≠n ƒë∆∞·ª£c. N·∫øu 1 v√†i ph·∫ßn trong URL l√† ƒë√£ ƒë∆∞·ª£c m√£ h√≥a URL-encoded th√¨ sao? v√≠ d·ª• http://www.educative.io/distributed.php?id=design v√† http://www.educative.io/distributed.php%3Fid%3Ddesign l√† gi·ªëng URL tr∆∞·ªõc ·ªü d·∫°ng m√£ h√≥a URL encoding.  C√°ch gi·∫£i quy·∫øt c√°c issues: Ch√∫ng ta c√≥ th·ªÉ th√™m v√†o 1 chu·ªói number t·ª± tƒÉng v√†o m·ªói input URL ƒë·ªÉ n√≥ th√†nh unique v√† sau ƒë√≥ t·∫°o ra chu·ªói hash. Ta kh√¥ng c·∫ßn l∆∞u tr·ªØ chu·ªói number t·ª± tƒÉng n√†y v√†o trong databases. Do ƒë√≥, c√°c v·∫•n ƒë·ªÅ c√≥ th·ªÉ g·∫∑p ph·∫£i v·ªõi c√°ch gi·∫£i quy·∫øt n√†y l√† chu·ªói number t·ª± tƒÉng n√†y ng√†y c√†ng tƒÉng. N√≥ c√≥ th·ªÉ tƒÉng m√£i m√£i? Vi·ªác th√™m v√†o 1 chu·ªói number t·ª± tƒÉng c≈©ng ·∫£nh h∆∞·ªüng t·ªõi hi·ªáu nƒÉng c·ªßa service.\nC√°ch gi·∫£i quy·∫øt kh√°c l√† th√™m v√†o user id (s·∫Ω l√† unique) v√†o input URL. Tuy nhi√™n, n·∫øu user kh√¥ng ƒëƒÉng nh·∫≠p, ta s·∫Ω ph·∫£i y√™u c·∫ßu user ch·ªçn 1 chu·ªói key duy nh·∫•t. Sau t·∫•t c·∫£ th√¨ ta v·∫´n ph·∫£i ƒë·ªëi m·∫∑t v·ªõi 1 m√¢u thu·∫´n conflict, ta s·∫Ω ph·∫£i gi·ªØ vi·ªác t·∫°o ra ƒë·ªãnh danh key cho t·ªõi khi ta t·∫°o ra ƒë∆∞·ª£c 1 chu·ªói key unique.\n  b. T·∫°o ƒë·ªãnh danh keys offline Ch√∫ng ta ƒë√£ c√≥ 1 standalone Key Generation Service (KGS) d√πng ƒë·ªÉ t·∫°o ra tr∆∞·ªõc c√°c chu·ªói 6 k√Ω t·ª± ng·∫´u nhi√™n v√† sau ƒë√≥ l∆∞u tr·ªØ ch√∫ng v√†o trong 1 database (ta g·ªçi ch√∫ng l√† key-DB). B·∫•t c·ª© khi n√†o ch√∫ng ta mu·ªën l√†m ng·∫Øn 1 URL, ta s·∫Ω l·∫•y c√°c keys ƒë√£ ƒë∆∞·ª£c t·∫°o s·∫µn tr∆∞·ªõc ƒë√≥ v√† s·ª≠ d·ª•ng n√≥. C√°ch ti·∫øp c·∫≠n n√†y s·∫Ω khi·∫øn m·ªçi th·ª© tr·ªü n√™n ƒë∆°n gi·∫£n v√† nhanh h∆°n. Ch√∫ng ta kh√¥ng nh·ªØng kh√¥ng c·∫ßn m√£ h√≥a URL m√† c√≤n kh√¥ng ph·∫£i lo l·∫Øng v·ªÅ s·ª± tr√πng l·∫∑p hay m√¢u thu·∫´n. KGS s·∫Ω ƒë·∫£m b·∫£o m·ªçi keys ƒë∆∞·ª£c insert v√†o key-DB l√† duy nh·∫•t.\nVi·ªác x·ª≠ l√Ω song song c√≥ g√¢y ra v·∫•n ƒë·ªÅ g√¨ kh√¥ng? Khi key ƒë∆∞·ª£c s·ª≠ d·ª•ng, n√≥ s·∫Ω ƒë∆∞·ª£c ƒë√°nh d·∫•u trong database ƒë·ªÉ ch·∫Øc ch·∫Øn r·∫±ng n√≥ kh√¥ng ƒë∆∞·ª£c s·ª≠ d·ª•ng l·∫°i l·∫ßn n·ªØa. N·∫øu c√≥ nhi·ªÅu servers c√πng ƒë·ªçc keys n√†y v√†o c√πng 1 th·ªùi ƒëi·ªÉm song song, ch√∫ng ta s·∫Ω ph·∫£i ƒë·ªëi m·∫∑t v·ªõi ng·ªØ c·∫£nh khi m√† c√≥ 2 hay nhi·ªÅu h∆°n servers c√πng ƒë·ªçc c√πng 1 key t·ª´ database. C√°ch n√†o ƒë·ªÉ ta gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ x·ª≠ l√Ω song song n√†y?\nServers c√≥ th·ªÉ s·ª≠ d·ª•ng KGS ƒë·ªÉ ƒë·ªçc/ƒë√°nh d·∫•u c√°c keys trong database. KGS c√≥ th·ªÉ s·ª≠ d·ª•ng 2 tables ƒë·ªÉ l∆∞u tr·ªØ keys: 1 tables d√πng cho c√°c keys ch∆∞a ƒë∆∞·ª£c s·ª≠ d·ª•ng, v√† 1 table cho t·∫•t c·∫£ c√°c keys ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng. KGS c·∫•p ph√°t c√°c keys cho 1 trong c√°c servers n√†y, v√† ch√∫ng s·∫Ω th·ª±c hi·ªán di chuy·ªÉn key sang b·∫£ng table l∆∞u tr·ªØ keys ƒë√£ s·ª≠ d·ª•ng. KGS c√≥ th·ªÉ lu√¥n lu√¥n gi·ªØ 1 v√†i keys trong memory ƒë·ªÉ c·∫•p ph√°t ch√∫ng b·∫•t c·ª© khi n√†o servers c·∫ßn t·ªõi ch√∫ng.\nƒê·ªÉ ƒë∆°n gi·∫£n, KGS s·∫Ω n·∫°p 1 v√†i keys v√†o memory, n√≥ c√≥ th·ªÉ di chuy·ªÉn ch√∫ng sang table ch·ª© c√°c keys ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng. ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o m·ªói server s·∫Ω l·∫•y v·ªÅ c√°c unique keys. N·∫øu KGS dies tr∆∞·ªõc khi g√°n t·∫•t c·∫£ c√°c keys ƒë√£ ƒë∆∞·ª£c loaded t·ªõi 1 v√†i server, ch√∫ng ta s·∫Ω l√£ng ph√≠ nh·ªØng keys n√†y\u0026ndash;ƒëi·ªÅu n√†y c√≥ th·ªÉ ch·∫•p nh·∫≠n ƒë∆∞·ª£c.\nKGS c≈©ng ƒë·∫£m b·∫£o kh√¥ng c·∫•p ph√°t tr√πng keys t·ªõi nhi·ªÅu servers. V√≠ d·ª•, n√≥ s·∫Ω ph·∫£i th·ª±c hi·ªán ƒë·ªìng b·ªô (hay lock) c·∫•u tr√∫c d·ªØ li·ªáu data structure d√πng ƒë·ªÉ l∆∞u tr·ªØ keys tr∆∞·ªõc khi x√≥a b·ªè nh·ªØng keys n√†y kh·ªèi n√≥ v√†o c·∫•p ph√°t ch√∫ng cho 1 server.\nK√≠ch th∆∞·ªõc key-DB n√†y l√† bao nhi√™u? V·ªõi base64 encoding, ta c√≥ th·ªÉ t·∫°o ra ƒë∆∞·ª£c 68.7B chu·ªói unique keys c√≥ ƒë·ªô d√†i l√† 6 k√≠ t·ª±. N·∫øu ta c·∫ßn 1 byte ƒë·ªÉ l∆∞u tr·ªØ 1 k√≠ t·ª± alpha-numeric, th√¨ ta c·∫ßn:\n6 (characters per key) * 68.7B (unique keys) = 412 GB. KGS c√≥ single point of failure n√†o kh√¥ng? C√≥. ƒê·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y, ta c·∫ßn c√≥ 1 standby replica c·ªßa KGS. B·∫•t c·ª© khi n√†o, primary server dies th√¨ standby server s·∫Ω thay th·∫ø vai tr√≤ c·ªßa n√≥ ƒë·ªÉ t·∫°o v√† c·∫•p ph√°t keys.\nM·ªói app server c√≥ th·ª±c hi·ªán cache 1 v√†i keys t·ª´ key-DB? C√≥, ƒëi·ªÅu n√†y c√≥ th·ªÉ tƒÉng t·ªëc. M·∫∑c d√π, trong tr∆∞·ªùng h·ª£p n√†y, n·∫øu application server dies tr∆∞·ªõc khi ti√™u th·ª• t·∫•t c·∫£ c√°c keys, ch√∫ng ta s·∫Ω ch·∫•p nh·∫≠n ƒë·ªÉ m·∫•t c√°c keys ƒë√≥. ƒêi·ªÅu n√†y c√≥ th·ªÉ ch·∫•p nh·∫≠n do ch√∫ng ta c√≥ 68B unique keys c√≥ ƒë·ªô d√†i l√† 6 k√≠ t·ª±.\nC√°ch ch√∫ng ta th·ª±c hi·ªán x·ª≠ l√Ω key lookup? Ta c√≥ th·ªÉ lookup key trong database ƒë·ªÉ l·∫•y ra full URL. N·∫øu n√≥ t·ªìn t·∫°i trong DB, th√¨ ta s·∫Ω t·∫°o ra ‚ÄúHTTP 302 Redirect‚Äù status t·ªõi browser, chuy·ªÉn ti·∫øp stored URL v√†o trong tr∆∞·ªùng ‚ÄúLocation‚Äù field c·ªßa request. N·∫øu key kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng, th√¨ ta t·∫°o ra ‚ÄúHTTP 404 Not Found‚Äù status ho·∫∑c chuy·ªÉn h∆∞·ªõng user v·ªÅ l·∫°i homepage.\nTa c√≥ n√™n √°p ƒë·∫∑t h·∫°n m·ª©c size limits v√†o c√°c ƒë·ªãnh danh t√πy ch·ªânh custom aliases? D·ªãch v·ª• c·ªßa ta c√≥ h·ªó tr·ª£ custom aliases. Users c√≥ th·ªÉ l·ª±a ch·ªçn b·∫•t c·ª© ƒë·ªãnh danh \u0026lsquo;key\u0026rsquo; n√†o m√† h·ªç th√≠ch, nh∆∞ng vi·ªác cung c·∫•p 1 custom alias l√† kh√¥ng b·∫Øt bu·ªôc. Tuy nhi√™n, ta c·∫ßn √°p ƒë·∫∑t h·∫°n m·ª©c size limit v√†o c√°c custom alias ƒë·ªÉ ƒë·∫£m b·∫£o ch√∫ng ta c√≥ 1 URL database nh·∫•t qu√°n. Ch√∫ng ta gi·∫£ ƒë·ªãnh user c√≥ th·ªÉ ƒë·ªãnh nghƒ©a 1 ƒë·ªô d√†i t·ªëi ƒëa l√† 16 k√≠ t·ª± tr√™n m·ªói customer key (n√≥ ƒë√£ ƒë∆∞·ª£c ph·∫£n √°nh nh∆∞ trong database schema ·ªü tr√™n)\n7. Ph√¢n v√πng Data Partitioning v√† Replication ƒê·ªÉ m·ªü r·ªông scale out DB, ch√∫ng ta c·∫ßn ph√¢n t√°n d·ªØ li·ªáu do n√≥ c·∫ßn ch·ª©a h√†ng t·ª∑ URLs. Do ƒë√≥, ch√∫ng ta c·∫ßn ph√°t tri·ªÉn 1 partitioning scheme c√≥ kh·∫£ nƒÉng ph√¢n t√°n v√† chia n√≥ v√† l∆∞u tr·ªØ n√≥ ·ªü tr√™n nhi·ªÅu c√°c DB servers kh√°c nhau.\na. Ph√¢n t√°n d·ªØ li·ªáu theo Range based: ta c√≥ th·ªÉ l∆∞u tr·ªØ URLs v√†o c√°c ph√¢n v√πng partitions t√°ch bi·ªát d·ª±a v√†o k√≠ t·ª± ƒë·∫ßu ti√™n c·ªßa chu·ªói hash key. Do ƒë√≥ ta c√≥ th·ªÉ l∆∞u t·∫•t c·∫£ c√°c URL b·∫•t ƒë·∫ßu v·ªõi k√≠ t·ª± \u0026lsquo;A\u0026rsquo; hay \u0026lsquo;a\u0026rsquo; ·ªü trong 1 ph√¢n v√πng partition, t∆∞∆°ng t·ª± l∆∞u c√°c URL b·∫Øt ƒë·∫ßu v·ªõi k√≠ t·ª± \u0026lsquo;B\u0026rsquo; trong 1 ph√¢n v√πng partition kh√°c. C√°ch ti·∫øp c·∫≠n n√†y ƒë∆∞·ª£c g·ªçi l√† range-based partitioning. Ch√∫ng ta th·∫≠m ch√≠ c√≥ th·ªÉ nh√≥m g·ªôp c√°c k√≠ t·ª± √≠t xu·∫•t hi·ªán v√†o trong c√πng 1 database partition. Do ƒë√≥, ch√∫ng ta c√≥ th·ªÉ ph√°t tri·ªÉn 1 static partitioning scheme ƒë·ªÉ lu√¥n l∆∞u tr·ªØ/t√¨m ra 1 URL theo 1 c√°ch d·ªÖ ƒëo√°n ƒë·ªãnh.\nV·∫•n ƒë·ªÅ ch√≠nh v·ªõi c√°ch ti·∫øp c·∫≠n n√†y l√† n√≥ c√≥ th·ªÉ d·∫´n t·ªõi vi·ªác DB servers kh√¥ng ƒë∆∞·ª£c c√¢n b·∫±ng t·∫£i. V√≠ d·ª•, ta c√≥ th·ªÉ quy·∫øt ƒë·ªãnh l∆∞u tr·ªØ t·∫•t c·∫£ URLs b·∫Øt ƒë·∫ßu v·ªõi ksi t·ª± \u0026lsquo;E\u0026rsquo; v√†o trong ph√¢n v√πng 1 DB partition, nh∆∞ng n·∫øu sau n√†y khi ch√∫ng ta l·∫°i c√≥ qu√° nhi·ªÅu URLs b·∫Øt ƒë·∫ßu v·ªõi k√≠ t·ª± \u0026lsquo;E\u0026rsquo;.\nb. Ph√¢n t√°n d·ªØ li·ªáu theo Hash-Based: Theo schema n√†y, ch√∫ng ta t·∫°o ra 1 chu·ªói hash c·ªßa object m√† ta ƒëang l∆∞u tr·ªØ. Sau ƒë√≥ ta t√≠nh to√°n ƒë∆∞·ª£c ph√¢n v√πng partition n√†o ƒë∆∞·ª£c s·ª≠ d·ª•ng d·ª±a tr√™n chu·ªói hash. Trong tr∆∞·ªùng h·ª£p c·ªßa ch√∫ng ta, ta c√≥ th·ªÉ l·∫•y hash c·ªßa ƒë·ªãnh danh \u0026lsquo;key\u0026rsquo; hay short link ƒë·ªÉ x√°c ƒë·ªãnh ph√¢n v√πng partition d√πng ƒë·ªÉ l∆∞u tr·ªØ data object.\nH√†m hashing function s·∫Ω t·∫°o ra c√°c URLs ph√¢n ph·ªëi ng·∫´u nhi√™n v√†o c√°c ph√¢n v√πng partitions kh√°c nhau (v√≠ d·ª• h√†m hashing function c√≥ th·ªÉ lu√¥n lu√¥n √°nh x·∫° b·∫•t k·ª≥ \u0026lsquo;key\u0026rsquo; n√†o ƒë√≥ v·ªõi 1 s·ªë trong kho·∫£ng [1\u0026hellip;256]). S·ªë n√†y s·∫Ω bi·ªÉu th·ªã cho ph√¢n v√πng partition m√† ta l∆∞u tr·ªØ object ·ªü trong n√≥.\nC√°ch ti·∫øp c·∫≠n n√†y c√≥ th·ªÉ h∆∞·ªõng t·ªõi vi·ªác qu√° t·∫£i overloaded partitions, v·∫•n ƒë·ªÅ n√†y c√≥ th·ªÉ ƒë∆∞·ª£c gi·∫£i quy·∫øt b·∫±ng c√°ch s·ª≠ d·ª•ng Consistent Hashing.\n8. Cache Ch√∫ng ta c√≥ th·ªÉ cache c√°c URLs th∆∞·ªùng xuy√™n ƒë∆∞·ª£c truy c·∫≠p. Ta c√≥ th·ªÉ s·ª≠ d·ª•ng b·∫•t c·ª© gi·∫£i ph√°p n√†o c√≥ s·∫µn nh∆∞ Memcached, l∆∞u tr·ªØ full URLs v·ªõi chu·ªói ƒë·ªãnh danh hashes t∆∞∆°ng ·ª©ng c·ªßa n√≥. Do v·∫≠y, application servers, tr∆∞·ªõc khi hitting v√†o backend storage, ch√∫ng ta c√≥ th·ªÉ nhanh ch√≥ng ki·ªÉm tra ƒë∆∞·ª£c n·∫øu cache c√≥ ch·ª©a URL ƒëang ƒë∆∞·ª£c request.\nBao nhi√™u cache memory m√† ta s·∫Ω s·ª≠ d·ª•ng? Ch√∫ng ta c√≥ th·ªÉ b·∫Øt ƒë·∫ßu d·ª±a tr√™n 20% traffic truy c·∫≠p h√†ng ng√†y v√† d·ª±a tr√™n ∆∞·ªõc l∆∞·ª£ng s·ª≠ d·ª•ng c·ªßa client, ta c√≥ th·ªÉ bi·∫øt ƒë∆∞·ª£c bao nhi√™u cache servers m√† ta c·∫ßn. Gi·ªëng nh∆∞ vi·ªác ƒë·ªãnh l∆∞·ª£ng ·ªü tr√™n, ch√∫ng ta c·∫ßn 170GB memory ƒë·ªÉ cache 20% daily traffic. Do c√°c server hi·ªán ƒë·∫°i ng√†y nay c√≥ th·ªÉ c√≥ t·ªõi 256GB memory, n√™n ta c√≥ th·ªÉ d·ªÖ d√†ng ch·ª©a t·∫•t c·∫£ c√°c cache c·ªßa h·ªá th·ªëng tr√™n 1 m√°y. Hay c√°ch kh√°c, ta c√≥ th·ªÉ s·ª≠ d·ª•ng 1 nh√≥m c√°c servers nh·ªè h∆°n ƒë·ªÉ ch·ª©a c√°c hot URLs n√†y.\nCh√≠nh sach lo·∫°i b·ªè cache n√†o s·∫Ω ph√π h·ª£p nh·∫•t v·ªõi y√™u c·∫ßu h·ªá th·ªëng? Khi cache ƒë·∫ßy, v√† ta mu·ªën thay th·∫ø 1 link v·ªõi 1 URL m·ªõi hay hot h∆°n, ta s·∫Ω l√†m ƒëi·ªÅu n√†y b·∫±ng c√°ch n√†o? Ch√≠nh s√°ch Least Recently Used (LRU) c√≥ th·ªÉ ph√π h·ª£p v·ªõi h·ªá th·ªëng. V·ªõi ch√≠nh s√°ch n√†y ta c√≥ th·ªÉ lo·∫°i b·ªè c√°c URL √≠t ƒë∆∞·ª£c s·ª≠ d·ª•ng g·∫ßn ƒë√¢y nh·∫•t. Ta c√≥ th·ªÉ s·ª≠ d·ª•ng c·∫•u tr√∫c d·ªØ li·ªáu Linked Hash Map hay c·∫•u tr√∫c d·ªØ li·ªáu t∆∞∆°ng t·ª• ƒë·ªÉ l∆∞u tr·ªØ c√°c URLs v√† c√°c ƒë·ªãnh danh Hashes, c·∫•u tr√∫c n√†y s·∫Ω tr·ª£ gi√∫p ta track ƒë∆∞·ª£c c√°c URLs m√† ƒë∆∞·ª£c truy c·∫≠p g·∫ßn ƒë√¢y.\nƒê·ªÉ tƒÉng hi·ªáu qu·∫£, ta c√≥ th·ªÉ nh√¢n b·∫£n replicate c√°c caching servers ƒë·ªÉ ph√¢n ph·ªëi t·∫£i load gi·ªØa ch√∫ng.\nC√°ch m√† m·ªói cache replica ƒë∆∞·ª£c c·∫≠p nh·∫≠t? B·∫•t c·ª© khi n√†o cache miss, servers s·∫Ω hitting v√†o backend database. B·∫•t c·ª© khi n√†o vi·ªác n√†y x·∫£y ra, ta c√≥ th·ªÉ c·∫≠p nh·∫≠t cache v√† chuy·ªÉn ti·∫øp d·ªØ li·ªáu m·ªõi v√†o t·∫•t c·∫£ c√°c cache replicas. M·ªói replica c√≥ th·ªÉ c·∫≠p nh·∫≠t cache c·ªßa n√≥ b·∫±ng c√°ch th√™m v√†o d·ªØ li·ªáu m·ªõi. N·∫øu 1 replica ƒë√£ c√≥ d·ªØ li·ªáu n√†y, th√¨ n√≥ c√≥ th·ªÉ ƒë∆°n gi·∫£n t·ª´ ch·ªói c·∫≠p nh·∫≠t.\n  9. C√¢n b·∫±ng t·∫£i Load Balancer (LB) Ta c√≥ th·ªÉ th√™m 1 l·ªõp c√¢n b·∫±ng t·∫£i Load balancing layer v√†o 3 v·ªã tr√≠ sau trong h·ªá th·ªëng:\n Gi·ªØa Clients v√† Application servers. Gi·ªØa Application Servers v√† database servers. Gi·ªØa Application Servers v√† Cache servers.  ƒê·∫ßu ti√™n, ta c√≥ th·ªÉ s·ª≠ d·ª•ng c√°ch ti·∫øp c·∫≠n Round Robin ƒë∆°n gi·∫£n ƒë·ªÉ ph√¢n ph·ªëi c√°c incoming requests c√¢n b·∫±ng gi·ªØa c√°c backend servers. ƒê√¢y l√† c√°ch c√¢n b·∫±ng t·∫£i LB ƒë∆°n gi·∫£n ƒë·ªÉ th·ª±c thi. 1 ∆∞u ƒëi·ªÉm kh√°c c·ªßa c√°ch ti·∫øp c·∫≠n n√†y l√† n·∫øu 1 server ch·∫øt th√¨ LB s·∫Ω lo·∫°i b·ªè n√≥ ra kho·∫£n nh√≥m v√≤ng xoay v√† s·∫Ω ng·ª´ng g·ª≠i traffic t·ªõi n√≥.\n1 v·∫•n ƒë·ªÅ ph√°t sinh v·ªõi Round Robin LB l√† n√≥ kh√¥ng quan t√¢m t·ªõi t·∫£i server load. Do v·∫≠y, n·∫øu 1 server b·ªã qu√° t·∫£i hay b·ªã ch·∫≠m th√¨ LB s·∫Ω kh√¥ng ng·ª´ng g·ª≠i request m·ªõi t·ªõi server ƒë√≥. ƒê·ªÉ kh·∫Øc ph·ª•c v·∫•n ƒë·ªÅ n√†y, 1 gi·∫£i ph√°p LB th√¥ng minh h∆°n c√≥ th·ªÉ ƒë∆∞·ª£c √°p d·ª•ng l√† LB s·∫Ω ƒë·ªãnh k·ª≥ truy v·∫•n v·ªÅ t·∫£i c·ªßa backend server v√† ƒëi·ªÉu ch·ªânh traffic d·ª±a v√†o ƒë√≥.\n10. Thanh l·ªçc v√† d·ªçn d·∫πp DB C√°c d·ªØ li·ªáu c√≥ n√™n t·ªìn t·∫°i m√£i m√£i hay n√™n ƒë∆∞·ª£c thanh l·ªçc? N·∫øu th·ªùi gian h·∫øt h·∫°n do user ƒë·ªãnh nghƒ©a ƒë√£ ƒë·∫øn th√¨ ƒëi·ªÅu g√¨ c·∫ßn n√™n l√†m v·ªõi c√°c link h·∫øt h·∫°n n√†y?\nN·∫øu ta ch·ªçn c√°ch li√™n t·ª•c t√¨m ki·∫øm c√°c links ƒë√£ h·∫øt h·∫°n ƒë·ªÉ x√≥a ch√∫ng, th√¨ n√≥ g√¢y s·ª©c √©p l·ªõn ƒë·∫øn database. Thay v√†o ƒë√≥, ta c√≥ th·ªÉ ch·∫≠m r√£i x√≥a b·ªè c√°c links c≈© ƒë√£ h·∫øt h·∫°n n√†y b·∫±ng c√°ch d·ªçn d·∫πp ki·ªÉu lazy cleanup. Service c·ªßa ch√∫ng ta c≈©ng c·∫ßn ch·∫Øc ch·∫Øn v·ªõi c√°c links h·∫øt h·∫°n th√¨ s·∫Ω ƒë∆∞·ª£c x√≥a d√π 1 v√†i links ƒë√£ h·∫øt h·∫°n v·∫´n s·ªëng l√¢u h∆°n nh∆∞ng n√≥ s·∫Ω kh√¥ng bao gi·ªù ƒë∆∞·ª£c tr·∫£ v·ªÅ cho users.\n B·∫•t c·ª© khi n√†o user th·ª≠ truy c·∫≠p v√†o 1 link h·∫øt h·∫°n, ta c√≥ th·ªÉ x√≥a link n√†y v√† tr·∫£ v·ªÅ l·ªói cho user. 1 Cleanup service ƒë·ªôc l·∫≠p s·∫Ω ch·∫°y ƒë·ªãnh k·ª≥ ƒë·ªÉ x√≥a c√°c links ƒë√£ h·∫øt h·∫°n ra kh·ªèi storage v√† cache. Service n√†y s·∫Ω r·∫•t nh·∫π v√† ƒë∆∞·ª£c l·∫≠p l·ªãch ch·∫°y v√†o th·ªùi ƒëi·ªÉm m√† user traffice th·∫•p. Ta lu√¥n c√≥ 1 ng∆∞·ª°ng th·ªùi gian h·∫øt h·∫°n cho t·ª´ng link (v√≠ d·ª•: 2 nƒÉm). Sau khi x√≥a 1 link ƒë√£ h·∫øt h·∫°n, ta c√≥ th·ªÉ l∆∞u l·∫°i key tr·ªü l·∫°i key-DB ƒë·ªÉ t√°i s·ª≠ d·ª•ng l·∫°i. Ta c≈©ng n√™n xo√° c√°c links m√† kh√¥ng ƒë∆∞·ª£c truy c·∫≠p sau 1 kho·∫£ng th·ªùi gian, v√≠ d·ª• nh∆∞ 6 th√°ng? ƒê√¢y c√≥ th·ªÉ l√† 1 m·∫πo. Do l∆∞u tr·ªØ storage t∆∞∆°ng ƒë·ªëi r·∫ª, ta c≈©ng c√≥ th·ªÉ quy·∫øt ƒë·ªãnh l∆∞u tr·ªØ links m√£i m√£i.  11. Telemetry C√≥ t·ªïng s·ªë bao nhi√™u l·∫ßn 1 short URL ƒë∆∞·ª£c s·ª≠ d·ª•ng, hay user truy c·∫≠p ch√∫ng t·ª´ ƒë√¢u? C√°ch m√† ta s·∫Ω l∆∞u tr·ªØ c√°c th·ªëng k√™ n√†y? N·∫øu m·ªói l·∫ßn c√≥ 1 view m·ªõi ta l·∫°i th·ª±c hi·ªán c·∫≠p nh·∫≠t 1 DB row, th√¨ ƒëi·ªÅu g√¨ s·∫Ω x·∫£y ra khi 1 URL ph·ªï bi·∫øn c√≥ 1 l∆∞·ª£ng l·ªõn c√°c concurrent requests?\nM·ªôt v√†i th·ªëng k√™ kh√°c c≈©ng ƒë√°ng ƒë·ªÉ theo d√µi: qu·ªëc gia c·ªßa c√°c visitor, th·ªùi ƒëi·ªÉm c·ªßa c√°c truy c·∫≠p, c√°c web page tham chi·∫øu t·ªõi, browser, hay platform c·ªßa c√°c visitor.\n12. B·∫£o m·∫≠t v√† quy·ªÅn h·∫°n Security v√† Permissions Users c√≥ th·ªÉ t·∫°o ra c√°c private URLs hay cho ph√©p 1 t·∫≠p c√°c users c·ª• th·ªÉ n√†o ƒë√≥ ƒë∆∞·ª£c ph√©p truy c·∫≠p URL?\nCh√∫ng ta c√≥ th·ªÉ l∆∞u tr·ªØ m·ª©c quy·ªÅn h·∫°n permission level (public/private) v·ªõi t·ª´ng URL trong database. Ta c√≥ th·ªÉ t·∫°o ra 1 b·∫£ng table ri√™ng ƒë·ªÉ l∆∞u tr·ªØ c√°c UserIDs c√≥ quy·ªÅn truy c·∫≠p 1 URL c·ª• th·ªÉ. N·∫øu 1 user kh√¥ng c√≥ quy·ªÅn hay c·ªë g·∫Øng truy c·∫≠p v√†o 1 URL, ta c√≥ th·ªÉ g·ª≠i 1 l·ªói (HTTP 401). Nh∆∞ ƒë√£ tr√¨nh b√†y ·ªü tr√™n, ch√∫ng ta ƒëang l∆∞u tr·ªØ d·ªØ li·ªáu trong NoSQL wide-column database nh∆∞ Cassandra, kh√≥a key cho table l∆∞u tr·ªØ quy·ªÅn h·∫°n permissions s·∫Ω l√† \u0026lsquo;Hash\u0026rsquo; hay chu·ªói do KGS sinh ra. C·ªôt n√†y s·∫Ω l∆∞u tr·ªØ gi√° tr·ªã c·ªßa c√°c UserIDs ƒë∆∞·ª£c ph√©p truy c·∫≠p URL.\n","permalink":"https://lifesucks.dev/posts/grokking-system-design-interviews/designing-a-url-shortening-service-like-tinyurl/","summary":"1. T·∫°i sao ch√∫ng ta c·∫ßn 1 d·ªãch v·ª• ki·ªÉu l√†m ng·∫Øn URL shortening? URL shortening ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o ra c√°c ƒë·ªãnh danh ng·∫Øn g·ªçn h∆°n shorter aliases cho c√°c URLs d√†i d√≤ng. Ch√∫ng ta g·ªçi c√°c ƒë·ªãnh danh ƒë∆∞·ª£c l√†m ng·∫Øn n√†y l√† c√°c \u0026ldquo;short links.\u0026rdquo;. C√°c users ƒë∆∞·ª£c ƒëi·ªÅu h∆∞·ªõng t·ªõi URL g·ªëc khi h·ªç th·ª±c hi·ªán truy c·∫≠p v√†o c√°c short links n√†y. C√°c short links s·∫Ω ti·∫øt ki·ªám nhi·ªÅu kh√¥ng gian khi hi·ªán th·ªã, in ·∫•n, truy·ªÅn th√¥ng ƒëi·ªáp hay tweeted.","title":"B√†i 2: C√°ch thi·∫øt k·∫ø 1 d·ªãch v·ª• URL Shortening service gi·ªëng nh∆∞ TinyURL"},{"content":"1. Instagram l√† g√¨? Instagram l√† 1 d·ªãch v·ª• m·∫°ng x√£ h·ªôi cho ph√©p ng∆∞·ªùi d√πng users upload v√† chia s·∫ª c√°c h√¨nh ·∫£nh photos v√† videos c·ªßa h·ªç v·ªõi nh·ªØng ng∆∞·ªùi kh√°c. Ng∆∞·ªùi d√πng Instagram c√≥ th·ªÉ l·ª±a ch·ªçn chia s·∫ª th√¥ng th√¥ng qua c·∫£ 2 h√¨nh th·ª©c c√¥ng khai publicly v√† ri√™ng t∆∞ privately. B·∫•t c·ª© th·ª© g√¨ ƒë∆∞·ª£c chia s·∫ª c√¥ng khai c√≥ th·ªÉ ƒë∆∞·ª£c nh√¨n th·∫•y b·ªüi ng∆∞·ªùi d√πng kh√°c, m·∫∑t kh√°c nh·ªØng n·ªôi dung chia s·∫ª ri√™ng t∆∞ s·∫Ω ch·ªâ ƒë∆∞·ª£c truy c·∫≠p b·ªüi 1 nh√≥m ng∆∞·ªùi d√πng c·ª• th·ªÉ. Instagram cho ph√©p ng∆∞·ªùi d√πng n√≥ chia s·∫ª th√¥ng qua nhi·ªÅu n·ªÅn t·∫£ng m·∫°ng x√£ h·ªôi kh√°c, gi·ªëng nh∆∞ Facebook, Twitter, Flickr, v√† Tumblr.\nCh√∫ng ta s·∫Ω l√™n k·∫ø ho·∫°ch thi·∫øt k·∫ø 1 phi√™n b·∫£n ƒë∆°n gi·∫£n h∆°n c·ªßa Instagram v√¨ m·ª•c ƒë√≠ch thi·∫øt k·∫ø, n∆°i m√† ng∆∞·ªùi d√πng user c√≥ th·ªÉ chia s·∫ª photos v√† follow nh·ªØng ng∆∞·ªùi kh√°c. \u0026ldquo;News Feed\u0026rdquo; cho t·ª´ng user s·∫Ω ch·ªâ bao g·ªìm c√°c top photos c·ªßa t·∫•t c·∫£ g∆∞·ªùi d√πng kh√°c m√† user ƒëang follows.\n2. Y√™u c·∫ßu Requirements v√† m·ª•c ti√™u Goals c·ªßa h·ªá th·ªëng Ch√∫ng ta s·∫Ω t·∫≠p trung v√†o c√°c t·∫≠p y√™u c·∫ßu nh∆∞ sau khi th·ª±c hi·ªán thi·∫øt k·∫ø Instagram.\nC√°c y√™u c·∫ßu v·ªÅ m·∫∑t t√≠nh nƒÉng:\n Users c√≥ th·ªÉ upload/download/view photos. Users c√≥ th·ªÉ th·ª±c hi·ªán c√°c t√¨m ki·∫øm tr√™n c√°c ti√™u ƒë·ªÅ photo/video. Users c√≥ th·ªÉ theo d√µi follow ng∆∞·ªùi kh√°c. H·ªá th·ªëng s·∫Ω t·∫°o v√† hi·ªán th·ªã News Feed c·ªßa user - Ch·ª©a c√°c top photos c·ªßa t·∫•t c·∫£ c√°c ng∆∞·ªùi d√πng m√† h·ªç theo d√µi.  Y√™u c·∫ßu kh√¥ng li√™n quan t·ªõi t√≠nh nƒÉng:\n H·ªá th·ªëng c·∫ßn c√≥ t√≠nh s·∫µn s√†ng cao. ƒê·ªô tr·ªÖ c√≥ th·ªÉ ch·∫•p nh·∫≠n ƒë∆∞·ª£c c·ªßa h·ªá th·ªëng l√† 200ms cho vi·ªác t·∫°o ra News Feed. H·ªá th·ªëng ch·∫•p nh·∫≠n t√≠nh nh·∫•t qu√°n c√≥ th·ªÉ ·∫£nh h∆∞·ªüng n·∫øu ng∆∞·ªùi d√πng kh√¥ng nh√¨n th·∫•y 1 photo trong 1 kho·∫£ng th·ªùi gian. H·ªá th·ªëng c√≥ ƒë·ªô tin c·∫≠y cao, b·∫•t c·ª© photo hay video n√†o ƒë√£ ƒë∆∞·ª£c upload th√¨ s·∫Ω kh√¥ng bao gi·ªù b·ªã m·∫•t.  Kh√¥ng n·∫±m trong scope: Vi·ªác theo tags v√†o photos, t√¨m ki·∫øm photos d·ª±a tr√™n tag, b√¨nh lu·∫≠n v√†o photos, tagging ng∆∞·ªùi d√πng user v√†o photos, etc.\n3. 1 v√†i ch√∫ √Ω c·∫ßn xem x√©t ƒë·∫øn khi th·ª±c hi·ªán thi·∫øt k·∫ø H·ªá th·ªëng s·∫Ω n·∫∑ng t·∫£i v·ªÅ read, do v·∫≠y ta s·∫Ω t·∫≠p trung v√†o x√¢y d·ª±ng 1 h·ªá th·ªëng sao cho vi·ªác l·∫•y ra c√°c photos 1 c√°ch nhanh nh·∫•t.\n Th·ª±c t·∫ø, users c√≥ th·ªÉ upload bao nhi√™u photos t√πy th√≠ch, do v·∫≠y vi·ªác qu·∫£n l√Ω l∆∞u tr·ªØ storage 1 c√°ch hi·ªáu qu·∫£ s·∫Ω l√† 1 nh√¢n t·ªë ƒë√≥ng vai tr√≤ quan tr·ªçng trong thi·∫øt k·∫ø h·ªá th·ªëng. ƒê·ªô tr·ªÖ th·∫•p nh∆∞ k·ª≥ v·ªçng khi th·ª±c hi·ªán viewing photos. Data c≈©ng c·∫ßn 100% tin c·∫≠y. N·∫øu 1 user upload 1 photo th√¨ h·ªá th·ªëng s·∫Ω ƒë·∫£m b·∫£o n√≥ s·∫Ω kh√¥ng bao gi·ªù b·ªã m·∫•t.  4. ƒê·ªãnh l∆∞·ª£ng s·ª©c ch·ª©a Capacity v√† c√°c r√†ng bu·ªôc Constraints  Ta gi·∫£ s·ª≠ ch√∫ng ra c√≥ t·ªïng s·ªë 500M users, v·ªõi 1M user ho·∫°t ƒë·ªông h√†ng ng√†y. 2M photos m·ªõi ƒë∆∞·ª£c t·∫°o ra m·ªói ng√†y, 23 new photos m·ªói gi√¢y. Trung b√¨nh k√≠ch th∆∞·ªõc 1 photo =\u0026gt; 200KB. T·ªïng s·ªë l∆∞u tr·ªØ b·∫Øt bu·ªôc cho t·∫•t c·∫£ photos trong 1 ng√†y l√†: 2M * 200KB =\u0026gt; 400 GB T·ªïng s·ªë l∆∞u tr·ªØ b·∫Øt bu·ªôc cho t·∫•t c·∫£ photos trong 10 nƒÉm l√†: 400GB *365 (days a year)* 10 (years) ~= 1425TB  5. High Level System Design ·ªû m·ª©c high-level, ch√∫ng ta c·∫ßn support 2 ng·ªØ c·∫£nh, 1 l√† th·ª±c hi·ªán upload photos, 2 l√† khi th·ª±c hi·ªán view/search photos. Do ƒë√≥ d·ªãch v·ª• ch√∫ng ta thi·∫øt k·∫ø s·∫Ω c·∫ßn c√°c object storage servers ƒë·ªÉ l∆∞u t·ªØ photos v√† database servers ƒë·ªÉ l∆∞u tr·ªØ c√°c th√¥ng tin metadata c·ªßa photos.\n6. Database Schema  Vi·ªác ƒë·ªãnh nghi√£ DB schema ·ªü nh·ªØng giai ƒëo·∫°n ƒë·∫ßu ti√™n c·ªßa cu·ªôc ph·ªèng v·∫•n s·∫Ω gi√∫p m·ªçi ng∆∞·ªùi hi·ªÉu v·ªÅ lu·ªìng data flow gi·ªØa c√°c th√†nh ph·∫ßn components kh√°c nhau trong h·ªá th·ªëng v√† gi√∫p ƒë·ªãnh h∆∞·ªõng c√°ch ph√¢n v√πng d·ªØ li·ªáu data partitioning sau n√†y.\n Ch√∫ng ta c·∫ßn l∆∞u tr·ªØ d·ªØ li·ªáu v·ªÅ users, c√°c photos ƒë∆∞·ª£c upload l√™n b·ªüi h·ªç, nh·ªØng ng∆∞·ªùi h·ªç ƒëang theo d√µi follow. b·∫£ng Photo s·∫Ω ch·ª©a t·∫•t c·∫£ c√°c d·ªØ li·ªáu li√™n quan t·ªõi ·∫£nh photo; ch√∫ng ta c·∫ßn ƒë√°nh index tr√™n c·∫∑p (PhotoID, CreationDate) do ta c·∫ßn l·∫•y ra nh·ªØng photo ƒë∆∞·ª£c upload l√™n g·∫ßn ƒë√¢y tr∆∞·ªõc ti√™n.\n1 c√°ch ti·∫øp c·∫≠n h·∫øt s·ª©c hi·ªÉn nhi√™n cho vi·ªác l∆∞u tr·ªØ gi·ªëng nh∆∞ database schema ·ªü tr√™n l√† s·ª≠ d·ª•ng 1 RDBMS nh∆∞ MySQL do ta c√≥ s·ª≠ d·ª•ng ƒë·∫øn joins. Nh∆∞ng databases quan h·ªá c≈©ng ƒëi c√πng nh·ªØng th√°ch th·ª©c c·ªßa ch√∫ng, ƒë·∫∑c bi·ªát l√† khi ta c·∫ßn m·ªü r·ªông scale ch√∫ng.\nCh√∫ng ta c√≥ th·ªÉ l∆∞u tr·ªØ photos ·ªü nh·ªØng h·ªá th·ªëng l∆∞u tr·ªØ ph√¢n t√°n file distributed file storage gi·ªëng nh∆∞ HDFS hay S3.\nCh√∫ng ta c√≥ th·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu ·ªü schema tr√™n d∆∞·ªõi d·∫°ng l∆∞u tr·ªØ ph√¢n t√°n distributed key-value ƒë·ªÉ t·∫≠n d·ª±ng ƒë∆∞·ª£c c√°c ∆∞u ƒëi·ªÉm c·ªßa NoSQL. T·∫•t c·∫£ c√°c th√¥ng tin metadata li√™n quan t·ªõi photos l∆∞u tr·ªØ trong 1 table m√† c√≥ key l√† \u0026lsquo;PhotoID\u0026rsquo; v√† value s·∫Ω la 1 object ch·ª©a c√°c th√¥ng tin PhotoLocation, UserLocation, CreationTimestamp, etc.\nN·∫øu ch√∫ng ta ch·ªçn gi·∫£i ph√°p s·ª≠ d·ª•ng 1 NoSQL database, ch√∫ng ta c·∫ßn th√™m 1 table n·ªØa ƒë·ªÉ l∆∞u tr·ªØ quan h·ªá relationships gi·ªØa users v√† photos ƒë·ªÉ bi·∫øt ƒë∆∞·ª£c ai ƒëang s·ªü h·ªØu photo n√†o. Ch√∫ng ta s·∫Ω g·ªçi b·∫£ng n√†y l√† \u0026lsquo;UserPhoto\u0026rsquo;. Ch√∫ng ta c≈©ng c·∫ßn l∆∞u tr·ªØ danh s√°ch c√°c ng∆∞·ªùi m√† 1 user ƒëang theo d√µi follow. Ch√∫ng ta g·ªçi b·∫£ng n√†y l√† \u0026lsquo;UserFollow\u0026rsquo;. V·ªõi nh·ªØng b·∫£ng table d·∫°ng n√†y, ta c√≥ th·ªÉ s·ª≠ d·ª•ng 1 ki·ªÉu wide-column datastore gi·ªëng nh∆∞ Cassandra. V√≠ v·ªõi b·∫£ng UserPhoto, v·ªõi key l√† UserID v√† value l√† danh s√°ch c√°c PhotoIDs m√† user s·ªü h·ªØu, ƒë∆∞·ª£c l∆∞u tr·ªØ ·ªü c√°c c·ªôt columns kh√°c nhau. Ch√∫ng ta s·∫Ω c√≥ schema t∆∞∆°ng t·ª± cho b·∫£ng UserFollow.\nCassandra hay c√°c ki·ªÉu key-value stores, th√¥ng th∆∞·ªùng lu√¥n duy tr√¨ 1 s·ªë l∆∞·ª£ng c√°c b·∫£n sao replicas ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh s·∫µn s√†ng c·ªßa h·ªá th·ªëng. V√† c≈©ng ·ªü trong nh·ªØng data stores d·∫°ng n√†y, vi·ªác x√≥a deletes s·∫Ω kh√¥ng ƒë∆∞·ª£c √°p d·ª•ng ngay l·∫≠p t·ª©c; d·ªØ li·ªáu data s·∫Ω v·∫´n c√≤n ƒë∆∞·ª£c l∆∞u tr·ªØ trong v√†i ng√†y (h·ªó tr·ª£ tr∆∞·ªùng h·ª£p mu·ªën undeleting) tr∆∞·ªõc khi b·ªã x√≥a vƒ©nh vi·ªÖn kh·ªèi h·ªá th·ªëng.\n7. ∆Ø·ªõc l∆∞·ª£ng Data Size Ch√∫ng ta s·∫Ω ∆∞·ªõc l∆∞·ª£ng c√°ch m√† d·ªØ li·ªáu data s·∫Ω gia tƒÉng ·ªü t·ª´ng b·∫£ng table v√† t·ªïng s·ªë l∆∞u tr·ªØ storage m√† ta c·∫ßn l∆∞u tr·ªØ trong 10 nƒÉm.\nUser: Gi·∫£ s·ª≠ r·∫±ng m·ªói ki·ªÉu d·ªØ li·ªáu \u0026lsquo;int\u0026rsquo; v√† \u0026lsquo;dataTime\u0026rsquo; c·∫ßn 4 bytes ƒë·ªÉ l∆∞u tr·ªØ, m·ªói d√≤ng row trong b·∫£ng User s·∫Ω c·∫ßn 68 bytes:\nUserID (4 bytes) + Name (20 bytes) + Email (32 bytes) + DateOfBirth (4 bytes) + CreationDate (4 bytes) + LastLogin (4 bytes) = 68 bytes N·∫øu ch√∫ng ta c√≥ 500M users, th√¨ ta s·∫Ω c·∫ßn 32GB ƒë·ªÉ l∆∞u tr·ªØ:\n500 million * 68 ~= 32GB Photo: M·ªói row trong b·∫£ng Photo s·∫Ω c·∫ßn 284 bytes:\nPhotoID (4 bytes) + UserID (4 bytes) + PhotoPath (256 bytes) + PhotoLatitude (4 bytes) + PhotoLongitude(4 bytes) + UserLatitude (4 bytes) + UserLongitude (4 bytes) + CreationDate (4 bytes) = 284 bytes N·∫øu c√≥ 2M photos m·ªõi ƒë∆∞·ª£c upload m·ªói ng√†y, ch√∫ng ta s·∫Ω c·∫ßn 0.5GB l∆∞u tr·ªØ cho m·ªói ng√†y:\n2M * 284 bytes ~= 0.5GB per day V·ªõi 10 nƒÉm, ta s·∫Ω c·∫ßn 1.88TB l∆∞u tr·ªØ.\nUserFollow: M·ªói row trong UserFollow s·∫Ω c·∫ßn 8 bytes. N·∫øu ta c√≥ 500M users v√† trung b√¨nh m·ªói user s·∫Ω th·ª±c hi·ªán theo d√µi follow 500 ng∆∞·ªùi kh√°c. Ch√∫ng ta s·∫Ω c·∫ßn 1.82TB l∆∞u tr·ªØ cho UserFollow:\n500 million users * 500 followers * 8 bytes ~= 1.82TB T·ªïng dung l∆∞·ª£ng c·∫ßn ƒë·ªÉ l∆∞u tr·ªØ t·∫•t c·∫£ c√°c tables trong v√≤ng 10 nƒÉm s·∫Ω l√† 3.7TB:\n32GB + 1.88TB + 1.82TB ~= 3.7TB 8. Component Design Vi·ªác photo ƒë∆∞·ª£c upload (hay write) c√≥ th·ªÉ tr·ªü n√™n ch·∫≠m n·∫øu ch√∫ng ƒë∆∞·ª£c ghi tr·ª±c ti·∫øp v√†o ·ªï disk, trong khi vi·ªác ƒë·ªçc reads s·∫Ω nhanh h∆°n, ƒë·∫∑c bi·ªát n·∫øu ch√∫ng ƒë∆∞·ª£c ƒë·ªçc t·ª´ cache.\nNh·ªØng ng∆∞·ªùi d√πng th·ª±c hi·ªán upload c√≥ th·ªÉ s·ª≠ d·ª•ng h·∫øt c√°c connections hi·ªán c√≥ c·ªßa h·ªá th·ªëng, do vi·ªác th·ª±c hi·ªán uploading ƒë∆∞·ª£c x√©t l√† 1 slow process. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† reads c√≥ th·ªÉ b·ªã ·∫£nh h∆∞·ªüng n·∫øu h·ªá th·ªëng b·ªã qu√° t·∫£i v·ªõi c√°c write request. Ch√∫ng ta c≈©ng c·∫ßn l∆∞u √Ω r·∫±ng 1 web server lu√¥n c√≥ 1 ng∆∞·ª°ng gi·ªõi h·∫°n connection limit. Ta gi·∫£ s·ª≠ r·∫±ng web server c√≥ 1 ng∆∞·ª°ng gi·ªõi h·∫°n l√† 500 connections t·∫°i 1 th·ªùi ƒëi·ªÉm, th√¨ n√≥ kh√¥ng th·ªÉ c√≥ h∆°n 500 uploads hay reads c√πng l√∫c. ƒê·ªÉ kh·∫Øc ph·ª•c ngh·∫Ωn c·ªï chai n√†y, ta c√≥ th·ªÉ ph√¢n chia reads v√† writes v√†o c√°c serivces ƒë·ªôc l·∫≠p. Ch√∫ng ta s·∫Ω c√≥ c√°c servers d√†nh ri√™ng cho vi·ªác reads v√† c√°c server kh√°c d√†nh ri√™ng cho vi·ªác writes ƒë·ªÉ ƒë·∫£m b·∫£o vi·ªác upload kh√¥ng ·∫£nh h∆∞·ªüng t·ªõi c·∫£ h·ªá th·ªëng.\nVi·ªác t√°ch bi·ªát read v√† write requests c≈©ng cho ph√©p ta m·ªü r·ªông v√† t·ªëi ∆∞u t·ª´ng lo·∫°i x·ª≠ l√Ω 1 c√°ch ƒë·ªôc l·∫≠p:\n9. ƒê·ªô tin c·∫≠y Reliability v√† t√≠nh d∆∞ th·ª´a Redundancy Vi·ªác ƒë·ªÉ m·∫•t m√°t c√°c files kh√¥ng ƒë∆∞·ª£c ph√©p x·∫£y ra ·ªü trong h·ªá th·ªëng. Do ƒë√≥, ta c·∫ßn l∆∞u tr·ªØ nhi·ªÅu b·∫£n copies c·ªßa t·ª´ng file v√† do ƒë√≥ n·∫øu storage server dies th√¨ ta v·∫´n c√≥ th·ªÉ l·∫•y ra ƒë∆∞·ª£c photo t·ª´ c√°c b·∫£n copy c·ªßa n√≥ ·ªü nh·ªØng storage server kh√°c.\nƒê·ªãnh lu·∫≠t n√†y c≈©ng s·∫Ω ƒë∆∞·ª£c √°p d·ª•ng cho c√°c th√†nh ph·∫ßn components kh√°c trong h·ªá th·ªëng. N·∫øu ta mu·ªën h·ªá th·ªëng c√≥ t√≠nh s·∫µn s√†ng cao, ch√∫ng ta c·∫ßn c√≥ nhi·ªÅu b·∫£n sao ch√©p replicas c·ªßa c√°c services ƒëang ch·∫°y trong h·ªá th·ªëng do n·∫øu c√≥ 1 v√†i services die th√¨ h·ªá th·ªëng v·∫´n ch·∫°y v√† ƒë·∫£m b·∫£o s·∫µn s√†ng. T√≠nh d∆∞ th·ª´a Redundancy s·∫Ω x√≥a b·ªè ƒëi·ªÉm y·∫øu single point of failure c·ªßa h·ªá th·ªëng.\nVi·ªác t·∫°o ra d∆∞ th·ª´a redundancy trong 1 h·ªá th·ªëng c√≥ th·ªÉ x√≥a b·ªè r·ªßi ro single points of failure v√† cung c·∫•p kh·∫£ nƒÉng backup hay d·ª± ph√≤ng n·∫øu c·∫ßn khi h·ªá th·ªëng g·∫∑p r·ªßi ro. V√≠ d·ª•, n·∫øu c√≥ 2 instances c·ªßa c√πng 1 service ƒëang ch·∫°y tr√™n production v√† khi 1 c√°i fail, th√¨ h·ªá th·ªëng c√≥ th·ªÉ chuy·ªÉn ƒë·ªïi d·ª± ph√≤ng failover t·ªõi b·∫£n copy kh·ªèe m·∫°nh. Failover c√≥ th·ªÉ x·∫£y ra 1 c√°ch t·ª± ƒë·ªông v√† kh√¥ng ƒë√≤i h·ªèi b·∫•t k·ª≥ s·ª± can thi·ªáp th·ªß c√¥ng n√†o.\n10. Data Sharding Gi·ªù ch√∫ng ta s·∫Ω b√†ng t·ªõi c√°c ki·ªÉu schemes kh√°c nhau ph·ª•c v·ª• cho metadata sharding:\na. Partitioning d·ª±a v√†o UserID Ta g·ªâa s·ª≠ r·∫±ng ch√∫ng ta s·∫Ω shard d·ª±a tr√™n \u0026lsquo;UserID\u0026rsquo; do ƒë√≥ ta c√≥ th·ªÉ gi·ªØ m·ªçi photos c·ªßa 1 user n·∫±m trong c√πng 1 shard. N·∫øu 1 DB shard l√† 1 TB, ch√∫ng ta s·∫Ω c·∫ßn 4 shards ƒë·ªÉ l∆∞u tr·ªØ 3.7TB d·ªØ li·ªáu. Ch√∫ng ta s·∫Ω gi·∫£ s·ª≠ r·∫±ng, v√¨ l√≠ do performace v√† scalability t·ªët h∆°n, ta s·∫Ω c·∫ßn 10 shards.\nDo v·∫≠y ta s·∫Ω t√≠nh ƒë∆∞·ª£c shard number b·∫±ng c√°ch l·∫•y s·ªë d∆∞ UserID chia cho 10 v√† s·∫Ω l∆∞u tr·ªØ d·ªØ li·ªáu data tr√™n shard number ƒë√≥. ƒê·ªÉ x√°c ƒë·ªãnh ƒë∆∞·ª£c t√≠nh unique c·ªßa photo trong h·ªá th·ªëng, ta c·∫ßn th√™m th√¥ng tin shard number v√†o sau m·ªói PhotoID.\nC√°ch m√† ta s·∫Ω t·∫°o ra PhotoIDs? M·ªói DB shard s·∫Ω c√≥ ri√™ng cho m√¨nh 1 chu·ªói t·ª± tƒÉng auto-increment sequence cho PhotoIDs, v√† do ƒë√≥ ta s·∫Ω th√™m ShardID v√†o sau m·ªói PhotoID, ta s·∫Ω khi·∫øn n√≥ unique tr√™n to√†n h·ªá th·ªëng.\nNh·ªØng v·∫•n ƒë·ªÅ s·∫Ω ph√°t sinh v·ªõi ki·ªÉu ph√¢n t√°n partitioning scheme n√†y?\n C√°ch m√† ta s·∫Ω x·ª≠ l√Ω ƒë·ªëi v·ªõi hot users? r·∫•t nhi·ªÅu ng∆∞·ªùi theo d√µi follow nh·ªØng hot users n√†y, v√† c≈©ng r·∫•t nhi·ªÅu ng∆∞·ªùi kh√°c xem nh·ªØng photo m√† nh·ªØng user n√†y upload l√™n. 1 v√†i users s·∫Ω c√≥ r·∫•t nhi·ªÅu photos so v·ªõi nh·ªØng ng∆∞·ªùi kh√°c, do v·∫≠y n√≥ s·∫Ω t·∫°o ra s·ª± ph·∫•n t√°n l∆∞u tr·ªØ kh√¥ng ƒë·ªìng ƒë·ªÅu. Ch√∫ng ta ph·∫£i l√†m g√¨ n·∫øu ta kh√¥ng l∆∞u tr·ªØ ƒë∆∞·ª£c t·∫•t c·∫£ c√°c ·∫£nh c·ªßa 1 ng∆∞·ªùi d√πng tr√™n c√πng 1 shard? N·∫øu ta ph√¢n t√°n photos c·ªßa 1 user ra tr√™n nhi·ªÅu shards, th√¨ n√≥ c√≥ g√¢y ra ƒë·ªô tr·ªÖ l·ªõn? Vi·ªác l∆∞u tr·ªØ t·∫•t c·∫£ c√°c photos c·ªßa 1 user tr√™n c√πng 1 shard c√≥ th·ªÉ g√¢y ra c√°c v·∫•n ƒë·ªÅ nh∆∞ ƒë·ªô s·∫µn s√†ng c·ªßa t·∫•t c·∫£ c√°c d·ªØ li·ªáu c·ªßa user s·∫Ω kh√¥ng truy c·∫≠p ƒë∆∞·ª£c n·∫øu shard down v√† ƒë·ªô tr·ªÖ cao n·∫øu shard n√≥ ƒëang cao t·∫£i.  b. Partitioning d·ª±a v√†o PhotoID N·∫øu ta c√≥ th·ªÉ t·∫°o ra unique PhotoIDs tr∆∞·ªõc v√† sau ƒë√≥ x√°c ƒë·ªãnh shard number d·ª±a v√†o ‚ÄúPhotoID % 10‚Äù, c√°c v·∫•n ƒë·ªÅ ƒë·∫∑t ra ·ªü tr√™n s·∫Ω ƒë∆∞·ª£c gi·∫£i quy·∫øt. Ta c≈©ng kh√¥ng c·∫ßn th√™m th√¥ng tin ShardID v√†o sau PhotoID trong tr∆∞·ªùng h·ª£p n√†y, do PhotoID b·∫£n th√¢n n√≥ ƒë√£ unique tr√™n to√†n b·ªô h·ªá th·ªëng.\nC√°ch m√† ta t·∫°o ra PhotoIDs? theo c√°ch n√†y, ta kh√¥ng c·∫ßn 1 chu·ªói t·ª± tƒÉng auto-incrementing sequence ·ªü m·ªói shard ƒë·ªÉ ƒë·ªãnh nghƒ©a PhotoID b·ªüi v√¨ ta c·∫ßn bi·∫øt v·ªÅ PhotoID tr∆∞·ªõc ƒë·ªÉ x√°c ƒë·ªãnh ra shard number m√† ta d√πng ƒë·ªÉ l∆∞u tr·ªØ d·ªØ li·ªáu. 1 gi·∫£i ph√°p kh√°c l√† ta c√≥ th·ªÉ danh ri√™ng 1 database instance ƒë·ªÉ t·∫°o ra c√°c IDs t·ª± tƒÉng auto-incrementing IDs. N·∫øu PhotoID c√≥ th·ªÉ ch·ª©a ƒë·ªß trong 64 bits, ta c√≥ th·ªÉ ƒë·ªãnh nghƒ©a 1 table ch·ªâ ch·ª©a 64 bit ID field. Do v·∫≠y b·∫•t c·ª© khi n√†o ta th√™m 1 photo v√†o h·ªá th·ªëng, ta c√≥ th·ªÉ th√™m m·ªõi 1 row m·ªõi v√†o table n√†y v√† l·∫•y gi√° tr·ªã ID ƒë√≥ l√†m PhotoID c·ªßa 1 photo m·ªõi.\nh·ªá th·ªëng key generating DB n√†y c√≥ ph·∫£i l√† 1 single point of failure? ƒê√∫ng v·∫≠y. 1 c√°ch gi·∫£i quy·∫øt cho v·∫•n ƒë·ªÅ n√†y l√† ta c√≥ th·ªÉ s·ª≠ d·ª•ng 2 databases, 1 c√°i ch·ªâ t·∫°o ra c√°c IDs l·∫ª, v√† c√°i c√≤n l·∫°i t·∫°o ra IDs ch·∫µn. V√≠ d·ª• v·ªõi MySQL, ta c√≥ th·ªÉ s·ª≠ d·ª•ng scripts sau ƒë·ªÉ ƒë·ªãnh nghƒ©a chu·ªói sequences:\nKeyGeneratingServer1: auto-increment-increment = 2 auto-increment-offset = 1 KeyGeneratingServer2: auto-increment-increment = 2 auto-increment-offset = 2 Ta c√≥ th·ªÉ ƒë·∫∑t 1 c√¢n b·∫±ng t·∫£i load balancer ·ªü tr∆∞·ªõc nh·ªØng databases n√†y ƒë·ªÉ c√¢n b·∫±ng t·∫£i round-robin gi·ªØa ch√∫ng v√† c≈©ng ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ downtime. Khi c·∫£ 2 servers b·ªã r∆°i kh·ªèi s·ª± ƒë·ªìng b·ªô n√†y, th√¨ s·∫Ω na·ª∑ sinh ra tr∆∞·ªùng h·ª£p server n√†y s·∫Ω t·∫°o ra nhi·ªÅu keys h∆°n so v·ªõi c√°i c√≤n l·∫°i, nh∆∞ng ƒëi·ªÅu n√†y kh√¥ng g√¢y ra v·∫•n ƒë·ªÅ g√¨ cho h·ªá th·ªëng. Ch√∫ng ta c√≥ th·ªÉ m·ªü r·ªông c√°ch thi·∫øt k·∫ø n√†y b·∫±ng c√°ch ƒë·ªãnh nghƒ©a ra c√°c b·∫£ng ID d√†nh ri√™ng cho Users, Photo-Comments, hay b·∫•t c·ª© c√°c ƒë·ªë t∆∞·ª£ng object n√†o kh√°c m√† c√≥ trong h·ªá th·ªëng.\nC√°ch ch√∫ng ta ho·∫°ch ƒë·ªãnh cho vi·ªác ph√°t tri·ªÉn c·ªßa h·ªá th·ªëng trong t∆∞∆°ng lai? Ch√∫ng ta c√≥ th·ªÉ c√≥ 1 l∆∞·ª£ng l·ªõn s·ªë ph√¢n v√πng d·ªØ li·ªáu logical partitions ƒë·ªÉ ƒë√°p ·ª©ng cho s·ª± ph√°t tri·ªÉn c·ªßa d·ªØ li·ªáu trong t∆∞∆°ng lai, gi·ªëng nh∆∞ th·ªùi ƒëi·ªÉm b·∫Øt ƒë·∫ßu, c√≥ th·ªÉ c√≥ nhi·ªÅu multiple logical partitions n·∫±m tr√™n c√πng 1 database server v·∫≠t l√Ω. Do m·ªói database server c√≥ th·ªÉ c√≥ nhi·ªÅu database instances ch·∫°y tr√™n n√≥, ch√∫ng ta c√≥ th·ªÉ c√≥ nhi·ªÅu databases t√°ch bi·ªát nhau tr√™n c√πng 1 ph√¢n v√πng logical partition ·ªü b·∫•t c·ª© server n√†o. Do ƒë√≥, b·∫•t c·ª© khi n√†o ta c·∫£m th·∫•y 1 database server n√†o ƒë√≥ c√≥ nhi·ªÅu d·ªØ li·ªáu, ta c√≥ th·ªÉ migrate 1 v√†i ph√¢n v√πng logical partitions t·ª´ n√≥ sang server kh√°c. Ta c√≥ th·ªÉ d·ª±a tr√™n 1 config file (hay config theo t·ª´ng database ri√™ng bi·ªát) ƒë·ªÉ map ph√¢n v√πng logical partitions c·ªßa ta v√†o c√°c database servers; ƒëi·ªÅu n√†y cho ph√©p ta di chuy·ªÉn c√°c ph√¢n v√πng partitions 1 c√°ch d·ªÖ d√†ng. B·∫•t c·ª© khi n√†o ta mu·ªën di chuy·ªÉn 1 ph√¢n v√πng partition, ta ch·ªâ ph·∫£i updat l·∫°i config file n√†y ƒë·ªÉ t·∫°o ra s·ª± thay ƒë·ªïi.\n11. C√°ch t·∫°o h·ªá th·ªëng Ranking v√† News Feed ƒê·ªÉ t·∫°o ra News Feed cho b·∫•t c·ª© user n√†o ƒë√≥, ta c·∫ßn l·∫•y ra c√°c photos m·ªõi nh·∫•t, ph·ªï bi·∫øn nh·∫•t, v√† photos c·ªßa nh·ªØng ng∆∞·ªùi m√† user ƒë√≥ ƒëang theo d√µi follow.\nƒê·ªÉ ƒë∆°n gi·∫£n, ta c√≥ th·ªÉ gi·∫£ ƒë·ªãnh r·∫±ng ta c·∫ßn l·∫•y ra 100 photos cho 1 News Feed c·ªßa 1 user. application server c·ªßa ta c·∫ßn l·∫•y ra 1 danh s√°ch c√°c ng∆∞·ªùi m√† user ƒëang theo d√µi v√† l·∫•y ra th√¥ng tin metadata info c·ªßa 100 photos m·ªõi nh·∫•t c·ªßa nh·ªØng ng∆∞·ªùi n√†y. B∆∞·ªõc cu·ªëi, server s·∫Ω submit to√†n b·ªô nh·ªØng photos n√†y t·ªõi thu·∫≠t to√°n ranking c·ªßa ta, n√≥ s·∫Ω x√°c ƒë·ªãnh top 100 photos (d·ª±a tr√™n th·ªùi ƒëi·ªÉm xu·∫•t hi·ªán, s·ªë l∆∞·ª£ng like) v√† tr·∫£ v·ªÅ ch√∫ng cho ng∆∞·ªùi d√πng. 1 v·∫•n ƒë·ªÅ ta ph·∫£i ƒë·ªëi m·∫∑t l√† ƒë·ªô tr·ªÖ cao do ta ph·∫£i truy v·∫•n nhi·ªÅu tables v√† th·ª±c hi·ªán sorting/merging/ranking tr√™n t·∫≠p k·∫øt qu·∫£. ƒê·ªÉ c·∫£i thi·ªán hi·ªáu nƒÉng, ta c√≥ th·ªÉ t·∫°o tr∆∞·ªõc s·∫µn c√°c News Feed v√† ch·ª©a ch√∫ng trong 1 b·∫£ng table d√†nh ri√™ng.\nC√°ch t·∫°o tr∆∞·ªõc News Feed: Ch√∫ng ta c√≥ th·ªÉ d√†nh ri√™ng c√°c servers ƒë·ªÉ li√™n t·ª•c t·∫°o ra c√°c News Feeds c·ªßa users v√† s·∫Øp x·∫øp ch√∫ng trong b·∫£ng UserNewsFeed. Do v·∫≠y, b·∫•t c·ª© khi n√†o user c·∫ßn c√°c photo m·ªõi nh·∫•t trong News-Feed, ch√∫ng ta s·∫Ω ƒë∆°n gi·∫£n truy v·∫•n v√†o b·∫£ng table n√†y ƒë·ªÉ tr·∫£ v·ªÅ k·∫øt qu·∫£ ƒë√≥ cho user.\nB·∫•t c·ª© khi n√†o c√°c servers n√†y c·∫ßn t·∫°o ra News Feed cho 1 user, ch√∫ng s·∫Ω truy v·∫•n trong b·∫£ng UserNewsFeed tr∆∞·ªõc v√† t√¨m ra th·ªùi ƒëi·ªÉm t·∫°o g·∫ßn nh·∫•t c·ªßa News Feed, d·ª±a v√†o ƒë√≥ News-Feed m·ªõi s·∫Ω ƒë∆∞·ª£c t·∫°o t·ª´ th·ªùi ƒëi·ªÉm ƒë√≥ tr·ªü l·∫°i ƒë√¢y.\nC√≥ nh·ªØng c√°ch n√†o ƒë·ªÉ g·ª≠i c√°c News Feed m·ªõi cho c√°c users?\n Pull: Clients c√≥ th·ªÉ pull c√°c News-Feed t·ª´ server theo 1 kho·∫£ng th·ªùi gian ƒë·ªãnh k·ª≥ hay th·ªß c√¥ng b·∫•t c·ª© khi n√†o h·ªç c·∫ßn. C√°c v·∫•n ƒë·ªÅ ph√°t sinh v·ªõi c√°c ti·∫øp c·∫≠n n√†y: D·ªØ li·ªáu m·ªõi c√≥ th·ªÉ kh√¥ng ƒë∆∞·ª£c hi·ªán th·ªã ra cho users cho t·ªõi khi client th·ª±c hi·ªán pull request, ƒêa s·ªë th·ªùi gian, pull requests s·∫Ω tr·∫£ v·ªÅ k·∫øt qu·∫£ r·ªóng n·∫øu ch∆∞a c√≥ d·ªØ li·ªáu m·ªõi. Push: Server c√≥ th·ªÉ push d·ªØ li·ªáu m·ªõi xu·ªëng users s·ªõm nh·∫•t khi ch√∫ng v·ª´a xu·∫•t hi·ªán. ƒê·ªÉ qu·∫£n l√Ω vi·ªác n√†y hi·ªáu qu·∫£, users ph·∫£i duy tr√¨ 1 Long Poll request t·ªõi server ƒë·ªÉ nh·∫≠n v·ªÅ updates. V·∫•n ƒë·ªÅ ph√°t sinh v·ªõi c√°ch ti·∫øp c·∫≠n n√†y: 1 user c√≥ th·ªÉ theo d√µi r·∫•t nhi·ªÅu ng∆∞·ªùi hay 1 user n·ªïi ti·∫øng c√≥ th·ªÉ c√≥ h√†ng tri·ªáu ng∆∞·ªùi theo d√µi; trong tr∆∞·ªùng h·ª£p n√†y, server ph·∫£i push updates 1 c√°ch li√™n t·ª•c. Hybrid: Ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng 1 c√°ch lai hybrid. Ch√∫ng ta c√≥ th·ªÉ chuy·ªÉn t·∫•t c·∫£ c√°c users m√† c√≥ s·ªë l∆∞·ª£ng l·ªõn ng∆∞·ªùi theo d√µi th√†nh ki·ªÉu pull-based model v√† ch·ªâ push data v·ªõi nh·ªØng user ch·ªâ c√≥ 1 v√†i trƒÉm hay 1 v√†i ng√†n ng∆∞·ªùi theo d√µi. C√°ch ti·∫øp c·∫≠n kh·∫Øc l√† c√≥ th·ªÉ ƒë·ªÉ server push updates t·ªõi t·∫•t c·∫£ users m√† kh√¥ng ho·∫°t ƒë·ªông qu√° th∆∞·ªùng xuy√™n v√† cho ph√©p c√°c user v·ªõi nhi·ªÅu updates pull data 1 c√°ch th∆∞·ªùng xuy√™n.  12. C√°ch t·∫°o News Feed v·ªõi c√°c Sharded Data 1 trong c√°c y√™u c·∫ßu quan tr·ªçng nh·∫•t l√† vi·ªác t·∫°o ra News Feed cho b·∫•t c·ª© user n√†o ƒë√≥ ƒë·ªÉ l·∫•y v·ªÅ c√°c photos m·ªõi nh·∫•t t·ª´ t·∫•t c·∫£ nh·ªØng ng·ª´·ªùi m√† user theo d√µi. ƒê·ªÉ l√†m ƒë∆∞·ª£c ƒëi·ªÅu n√†y, ta c·∫ßn c√≥ 1 c∆° ch·∫ø ƒë·ªÉ sort photos theo th·ªùi gian t·∫°o. ƒê·ªÉ l√†m vi·ªác n√†y 1 c√°ch hi·ªáu qu·∫£, ta c√≥ th·ªÉ th√™m th·ªùi gian t·∫°o photo l√† 1 ph·∫ßn c·ªßa PhotoID. Do ƒë√≥ ta ch·ªâ c·∫ßn ƒë√°nh kh√≥a ch√≠nh v√†o PhotoID, l√† c√≥ th·ªÉ d·ªÖ d√†ng nhanh ch√≥ng t√¨m ra ƒë∆∞·ª£c c√°c PhotoIDs m·ªõi nh·∫•t.\nTa c√≥ th·ªÉ s·ª≠ d·ª•ng epoch time cho vi·ªác n√†y. Do v·∫≠y PhotoID s·∫Ω g·ªìm c√≥ 2 ph·∫ßn: ph·∫ßn ƒë·∫ßu ti√™n s·∫Ω bi·ªÉu di·ªÖn epoch time, ph·∫ßn th·ª© 2 s·∫Ω l√† 1 chu·ªói t·ª± tƒÉng auto-incrementing sequence. Do v·∫≠y khi t·∫°o ra 1 PhotoID m·ªõi, ta c·∫ßn l·∫•y ra epoch time hi·ªán t·∫°i v√† th√™m n√≥ v√†o 1 chu·ªói t·ª± tƒÉng auto-incrementing ID t·ª´ key-generating DB. Ta c√≥ th·ªÉ d·ªÖ d√†ng x√°c ƒë·ªãnh shard number t·ª´ PhotoID ( PhotoID % 10) n√†y v√† l∆∞u photo n√†y v√†o shard number ƒë√≥.\nK√≠ch th∆∞·ªõc PhotoID l√† bao nhi√™u? N·∫øu epoch time b·∫Øt ƒë·∫ßu t·ª´ th·ªùi ƒëi·ªÉm hi·ªán t·∫°i; v√† ta s·∫Ω c·∫ßn bao nhi√™u bits ƒë·ªÉ l∆∞u tr·ªØ s·ªë gi√¢y cho 50 nƒÉm t·ªõi?\n86400 sec/day * 365 (days a year) * 50 (years) =\u0026gt; 1.6 billion seconds Ch√∫ng ta c·∫ßn 31 bits ƒë·ªÉ l∆∞u tr·ªØ s·ªë n√†y. Do, ta ƒëang k·ª≥ v·ªçng trung b√¨nh c√≥ 23 photos m·ªõi m·ªói gi√¢y, ta c√≥ th·ªÉ ph·∫£i c·∫•p ph√°t th√™m 9 bits ƒë·ªÉ l∆∞u tr·ªØ chu·ªói t·ª± tƒÉng auto-incremented sequence n·ªØa. Do m·ªói gi√¢y, ta c√≥ c·∫ßn l∆∞u tr≈© 2^9 = 512 photos m·ªõi. Ch√∫ng ta ƒëang c·∫•p ph√°y 9 bits cho chu·ªói t·ª± tƒÉng l√† nhi·ªÅu h∆°n nh·ªØng g√¨ m√† ta y√™u c·∫ßu; ch√∫ng ta l√†m vi·ªác n√†y b·∫±ng c√°ch l·∫•y ra 1 s·ªë full byte number (as 40 bits = 5 bytes40bits=5bytes). Ta c√≥ th·ªÉ reset l·∫°i chu·ªói t·ª± tƒÉng auto-incrementing sequence v√†o m·ªói gi√¢y.\n13. Cache v√† Load balancing Ch√∫ng ta c·∫ßn 1 h·ªá th·ªëng ph√¢n ph·ªëi ·∫£nh c√≥ kh·∫£ nƒÉng m·ªü r·ªông l·ªõn ƒë·ªÉ ƒë√°p ·ª©ng c√°c users n·∫±m ph√¢n t√°n tr√™n to√†n c·∫ßu. H·ªá th·ªëng ch·ªâ n√™n push c√°c b·ªôi dung content g·∫ßn v·ªõi user b·∫±ng c√°ch s·ª≠ d·ª•ng l∆∞·ª£ng l·ªõn c√°c photo cache servers ƒë∆∞·ª£c ph√¢n t√°n theo v√πng ƒë·ªãa l√Ω v√† s·ª≠ d·ª•ng CDNs.\nCh√∫ng ta c√≥ th·ªÉ th√™m v√†o 1 c∆° ch·∫ø cache cho metadata servers ƒë·ªÉ cache l·∫°i c√°c hot database rows. Ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng Memcache ƒë·ªÉ cache data, v√† Application servers tr∆∞·ªõc khi hit v√†o database c√≥ th·ªÉ nhanh ch√≥ng ki·ªÉm tra ƒë∆∞·ª£c cache c√≥ ch·ª©a d·ªØ li·ªáu mong mu·ªën. Ch√≠nh s√°ch LRU c√≥ th·ªÉ ƒë∆∞·ª£c √°p d·ª•ng ƒë·ªÉ x√≥a cache trong h·ªá th·ªëng c·ªßa ta. Khi d√πng ch√≠nh s√°ch n√†y, ta s·∫Ω lo·∫°i b·ªè ƒë∆∞·ª£c c√°c row √≠t ƒë∆∞·ª£c xem tr∆∞·ªõc ti√™n.\nC√°ch m√† ta x√¢y d·ª±ng 1 h·ªá th·ªëng cache th√¥ng minh h∆°n? N·∫øu ta tu√¢n theo ƒë·ªãnh lu·∫≠t 80/20, th√¨ 20% t·ªïng s·∫£n l∆∞·ª£ng read h√†ng ng√†y s·∫Ω t·∫°o ra 80% traffic, ƒëi·ªÅu n√†y c√≥ nghƒ©a l√† 1 v√†i photos nh·∫•t ƒë·ªãnh s·∫Ω tr·ªü n√™n ph·ªï bi·∫øn v√† ƒë∆∞·ª£c nhi·ªÅu ng∆∞·ªùi ƒë·ªçc ch√∫ng. ƒêi·ªÅu n√†y cho th·∫•y r·∫±ng ch√∫ng ta c√≥ th·ªÉ th·ª≠ l∆∞u v√†o b·ªô nh·ªõ ƒë·ªám 20% kh·ªëi l∆∞·ª£ng ·∫£nh v√† metadata ƒë·ªçc h√†ng ng√†y.\n","permalink":"https://lifesucks.dev/posts/grokking-system-design-interviews/designing-instagram/","summary":"1. Instagram l√† g√¨? Instagram l√† 1 d·ªãch v·ª• m·∫°ng x√£ h·ªôi cho ph√©p ng∆∞·ªùi d√πng users upload v√† chia s·∫ª c√°c h√¨nh ·∫£nh photos v√† videos c·ªßa h·ªç v·ªõi nh·ªØng ng∆∞·ªùi kh√°c. Ng∆∞·ªùi d√πng Instagram c√≥ th·ªÉ l·ª±a ch·ªçn chia s·∫ª th√¥ng th√¥ng qua c·∫£ 2 h√¨nh th·ª©c c√¥ng khai publicly v√† ri√™ng t∆∞ privately. B·∫•t c·ª© th·ª© g√¨ ƒë∆∞·ª£c chia s·∫ª c√¥ng khai c√≥ th·ªÉ ƒë∆∞·ª£c nh√¨n th·∫•y b·ªüi ng∆∞·ªùi d√πng kh√°c, m·∫∑t kh√°c nh·ªØng n·ªôi dung chia s·∫ª ri√™ng t∆∞ s·∫Ω ch·ªâ ƒë∆∞·ª£c truy c·∫≠p b·ªüi 1 nh√≥m ng∆∞·ªùi d√πng c·ª• th·ªÉ.","title":"B√†i 4: C√°ch thi·∫øt k·∫ø  Instagram"}]